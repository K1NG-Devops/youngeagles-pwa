var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&i(e,a,t[a]);if(s)for(var a of s(t))l.call(t,a)&&i(e,a,t[a]);return e},d=(e,s)=>t(e,a(s)),o=(e,t,a)=>new Promise((s,r)=>{var l=e=>{try{n(a.next(e))}catch(t){r(t)}},i=e=>{try{n(a.throw(e))}catch(t){r(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,i);n((a=a.apply(e,t)).next())});import{r as c}from"./vendor-react-BHu_3aIX.js";import{l as x,A as g,n as u,j as m,E as b,K as h,aw as p,t as y,aD as v,f as j,aE as f,aa as N,a7 as w,aF as _,J as k,ar as S,aq as C,C as D,q as R,aG as P,aH as $,u as A,N as T,ai as M,aI as F,ac as I,aJ as E,aK as U,aL as L,c as B,aj as O,i as q,aM as V}from"./index-BetBoxhn.js";import{u as J}from"./vendor-router-BfAStt8k.js";import"./vendor-utils-C_UPlz3V.js";const H=()=>{var e,t,a,s,r;const{isDark:l}=x(),[i,n]=c.useState([]),[d,S]=c.useState([]),[C,D]=c.useState(null),[R,P]=c.useState(null),[$,A]=c.useState(!0),[T,M]=c.useState(""),[F,I]=c.useState("all"),[E,U]=c.useState("all"),[L,B]=c.useState("all"),[O,q]=c.useState(!1),[V,J]=c.useState(!1),[H,Y]=c.useState(!1),[X,ee]=c.useState([]),[te,ae]=c.useState(null),[se,re]=c.useState(1),[le,ie]=c.useState("created_at"),[ne,de]=c.useState("desc"),[oe,ce]=c.useState({totalRevenue:0,monthlyRecurring:0,annualRecurring:0,averageRevenue:0,churnRate:0,growthRate:0,lifetimeValue:0,conversionRate:0}),[xe,ge]=c.useState([]),[ue,me]=c.useState([]),[be,he]=c.useState([]),[pe,ye]=c.useState(!1),[ve,je]=c.useState(!1);c.useEffect(()=>{fe(),Ne();const e=setInterval(()=>{fe(),Ne()},6e4);return()=>clearInterval(e)},[]),c.useEffect(()=>{_e()},[i,T,F,E,L,le,ne]);const fe=()=>o(void 0,null,function*(){try{A(!0);const[e,t,a,s,r]=yield Promise.all([g.subscriptions.admin.getAllSubscriptions(1e3,0,{sort:le,direction:ne,include_analytics:!0}),g.subscriptions.admin.getStats(),g.subscriptions.admin.getUpcomingRenewals(30),g.subscriptions.admin.getExpiringTrials(7),g.subscriptions.admin.getRecentActivity(50)]);n(e.data.subscriptions||[]),D(t.data.stats),ge(a.data.renewals||[]),me(s.data.trials||[]),he(r.data.activity||[])}catch(e){u.error("Failed to load subscription data"),we()}finally{A(!1)}}),Ne=()=>o(void 0,null,function*(){try{const e=yield g.subscriptions.admin.getAnalytics({period:"30d",include_predictions:!0});P(e.data.analytics),ce(e.data.revenue_metrics)}catch(e){ce({totalRevenue:12450,monthlyRecurring:8750,annualRecurring:3700,averageRevenue:45.5,churnRate:2.3,growthRate:12.5,lifetimeValue:245,conversionRate:8.7})}}),we=()=>{n([{id:1,user_id:101,user_name:"John Smith",user_email:"john.smith@example.com",plan_id:"family",plan_name:"Family Plan",status:"active",billing_cycle:"monthly",price_monthly:29.99,price_annual:299.99,subscription_start_date:"2024-01-01",subscription_end_date:"2024-02-01",payment_method:"credit_card",auto_renew:!0,trial_end_date:null,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"},{id:2,user_id:102,user_name:"Mary Johnson",user_email:"mary.johnson@example.com",plan_id:"student",plan_name:"Student Plan",status:"trial",billing_cycle:"monthly",price_monthly:19.99,price_annual:199.99,subscription_start_date:"2024-01-15",subscription_end_date:"2024-02-15",payment_method:"payfast",auto_renew:!1,trial_end_date:"2024-01-29",created_at:"2024-01-15T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"}]),D({total_subscriptions:2,active_subscriptions:1,trial_subscriptions:1,cancelled_subscriptions:0,monthly_recurring_revenue:29.99,annual_recurring_revenue:0,average_revenue_per_user:24.99,churn_rate:0,growth_rate:100})},_e=()=>{let e=[...i];if(T&&(e=e.filter(e=>{var t,a,s;return(null==(t=e.user_email)?void 0:t.toLowerCase().includes(T.toLowerCase()))||(null==(a=e.user_name)?void 0:a.toLowerCase().includes(T.toLowerCase()))||(null==(s=e.plan_name)?void 0:s.toLowerCase().includes(T.toLowerCase()))||e.id.toString().includes(T)})),"all"!==F&&(e=e.filter(e=>e.status===F)),"all"!==E&&(e=e.filter(e=>e.plan_id===E)),"all"!==L){const t=new Date,a=new Date;switch(L){case"7d":a.setDate(t.getDate()-7);break;case"30d":a.setDate(t.getDate()-30);break;case"90d":a.setDate(t.getDate()-90)}"all"!==L&&(e=e.filter(e=>new Date(e.created_at)>=a))}e.sort((e,t)=>{let a=e[le],s=t[le];return le.includes("date")&&(a=new Date(a),s=new Date(s)),"asc"===ne?a>s?1:-1:a<s?1:-1}),S(e),re(1)},ke=e=>o(void 0,null,function*(){if(0!==X.length)try{switch(e){case"activate":yield g.subscriptions.admin.bulkUpdateStatus(X,"active"),u.success(`${X.length} subscriptions activated`);break;case"suspend":yield g.subscriptions.admin.bulkUpdateStatus(X,"suspended"),u.success(`${X.length} subscriptions suspended`);break;case"cancel":yield g.subscriptions.admin.bulkUpdateStatus(X,"cancelled"),u.success(`${X.length} subscriptions cancelled`);break;case"extend":return void Y(!0)}ee([]),fe()}catch(t){u.error("Failed to perform bulk action")}else u.warning("Please select subscriptions to perform bulk action")}),Se=(e,t,a=null)=>o(void 0,null,function*(){try{yield g.subscriptions.admin.updateSubscriptionStatus(e,t,a),u.success("Subscription status updated successfully"),fe()}catch(s){u.error("Failed to update subscription status")}}),Ce=Math.ceil(d.length/20),De=20*(se-1),Re=De+20,Pe=d.slice(De,Re);return $?m.jsx("div",{className:"flex items-center justify-center h-64",children:m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):m.jsxs("div",{className:`p-6 ${l?"bg-gray-900":"bg-gray-50"} min-h-screen`,children:[m.jsxs("div",{className:"mb-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h1",{className:"text-2xl font-bold "+(l?"text-white":"text-gray-900"),children:"Enhanced Subscription Management"}),m.jsxs("div",{className:"flex space-x-3",children:[m.jsxs("button",{onClick:()=>{const e=d.map(e=>({ID:e.id,"User Email":e.user_email,"User Name":e.user_name,Plan:e.plan_name,Status:e.status,"Billing Cycle":e.billing_cycle,"Monthly Price":e.price_monthly,"Annual Price":e.price_annual,"Start Date":new Date(e.subscription_start_date).toLocaleDateString(),"End Date":new Date(e.subscription_end_date).toLocaleDateString(),"Payment Method":e.payment_method,"Auto Renew":e.auto_renew?"Yes":"No","Trial End":e.trial_end_date?new Date(e.trial_end_date).toLocaleDateString():"N/A",Created:new Date(e.created_at).toLocaleDateString(),Updated:new Date(e.updated_at).toLocaleDateString()})),t=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).join(","))].join("\n"),a=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`subscriptions_${(new Date).toISOString().split("T")[0]}.csv`,r.click(),window.URL.revokeObjectURL(s)},className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[m.jsx(b,{className:"inline mr-2"}),"Export"]}),m.jsxs("button",{onClick:()=>q(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[m.jsx(h,{className:"inline mr-2"}),"Create Manual Subscription"]}),m.jsxs("button",{onClick:fe,className:"px-4 py-2 rounded-lg font-medium transition-colors "+(l?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:[m.jsx(p,{className:"inline mr-2"}),"Refresh"]})]})]}),C&&m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[m.jsx(z,{title:"Total Subscriptions",value:C.total_subscriptions,icon:y,color:"blue",trend:C.growth_rate,subtitle:`${C.active_subscriptions} active`}),m.jsx(z,{title:"Monthly Revenue",value:`R${(null==(e=oe.monthlyRecurring)?void 0:e.toFixed(2))||"0.00"}`,icon:v,color:"green",trend:oe.growthRate,subtitle:`R${(null==(t=oe.averageRevenue)?void 0:t.toFixed(2))||"0.00"} avg/user`}),m.jsx(z,{title:"Churn Rate",value:`${(null==(a=oe.churnRate)?void 0:a.toFixed(1))||"0.0"}%`,icon:j,color:"red",trend:-oe.churnRate,subtitle:"Last 30 days"}),m.jsx(z,{title:"Conversion Rate",value:`${(null==(s=oe.conversionRate)?void 0:s.toFixed(1))||"0.0"}%`,icon:f,color:"purple",trend:oe.conversionRate,subtitle:"Trial to paid"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[m.jsx(G,{title:"Upcoming Renewals",value:xe.length,icon:N,color:"blue",subtitle:"Next 30 days",onClick:()=>ye(!0)}),m.jsx(G,{title:"Expiring Trials",value:ue.length,icon:w,color:"orange",subtitle:"Next 7 days",onClick:()=>je(!0)}),m.jsx(G,{title:"Lifetime Value",value:`R${(null==(r=oe.lifetimeValue)?void 0:r.toFixed(0))||"0"}`,icon:_,color:"green",subtitle:"Average LTV"})]}),m.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4",children:[m.jsx("div",{className:"flex-1 min-w-64",children:m.jsxs("div",{className:"relative",children:[m.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 "+(l?"text-gray-400":"text-gray-500")}),m.jsx("input",{type:"text",placeholder:"Search by email, name, plan, or ID...",value:T,onChange:e=>M(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border "+(l?"bg-gray-800 border-gray-700 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")})]})}),m.jsxs("select",{value:F,onChange:e=>I(e.target.value),className:"px-4 py-2 rounded-lg border "+(l?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"),children:[m.jsx("option",{value:"all",children:"All Statuses"}),m.jsx("option",{value:"active",children:"Active"}),m.jsx("option",{value:"trial",children:"Trial"}),m.jsx("option",{value:"cancelled",children:"Cancelled"}),m.jsx("option",{value:"expired",children:"Expired"}),m.jsx("option",{value:"suspended",children:"Suspended"})]}),m.jsxs("select",{value:E,onChange:e=>U(e.target.value),className:"px-4 py-2 rounded-lg border "+(l?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"),children:[m.jsx("option",{value:"all",children:"All Plans"}),m.jsx("option",{value:"free",children:"Free"}),m.jsx("option",{value:"student",children:"Student"}),m.jsx("option",{value:"family",children:"Family"}),m.jsx("option",{value:"institution",children:"Institution"})]}),m.jsxs("select",{value:L,onChange:e=>B(e.target.value),className:"px-4 py-2 rounded-lg border "+(l?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"),children:[m.jsx("option",{value:"all",children:"All Time"}),m.jsx("option",{value:"7d",children:"Last 7 Days"}),m.jsx("option",{value:"30d",children:"Last 30 Days"}),m.jsx("option",{value:"90d",children:"Last 90 Days"})]})]}),X.length>0&&m.jsx("div",{className:"p-4 rounded-lg border mb-4 "+(l?"bg-gray-800 border-gray-700":"bg-blue-50 border-blue-200"),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("span",{className:"font-medium "+(l?"text-white":"text-blue-900"),children:[X.length," subscriptions selected"]}),m.jsxs("div",{className:"flex space-x-2",children:[m.jsx("button",{onClick:()=>ke("activate"),className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",children:"Activate"}),m.jsx("button",{onClick:()=>ke("suspend"),className:"px-3 py-1 bg-yellow-500 text-white rounded text-sm hover:bg-yellow-600",children:"Suspend"}),m.jsx("button",{onClick:()=>ke("cancel"),className:"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600",children:"Cancel"}),m.jsx("button",{onClick:()=>ee([]),className:"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600",children:"Clear Selection"})]})]})})]}),m.jsxs("div",{className:"rounded-lg border overflow-hidden "+(l?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{className:l?"bg-gray-700":"bg-gray-50",children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium "+(l?"text-gray-300":"text-gray-500"),children:m.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?ee(Pe.map(e=>e.id)):ee([])},checked:X.length===Pe.length&&Pe.length>0})}),m.jsx(Z,{field:"user_email",label:"User",sortField:le,sortDirection:ne,onSort:(e,t)=>{ie(e),de(t)}}),m.jsx(Z,{field:"plan_name",label:"Plan",sortField:le,sortDirection:ne,onSort:(e,t)=>{ie(e),de(t)}}),m.jsx(Z,{field:"status",label:"Status",sortField:le,sortDirection:ne,onSort:(e,t)=>{ie(e),de(t)}}),m.jsx(Z,{field:"subscription_start_date",label:"Dates",sortField:le,sortDirection:ne,onSort:(e,t)=>{ie(e),de(t)}}),m.jsx(Z,{field:"price_monthly",label:"Revenue",sortField:le,sortDirection:ne,onSort:(e,t)=>{ie(e),de(t)}}),m.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium "+(l?"text-gray-300":"text-gray-500"),children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Pe.map(e=>m.jsx(K,{subscription:e,onUpdateStatus:Se,onViewDetails:ae,isSelected:X.includes(e.id),onSelect:(e,t)=>{ee(t?[...X,e]:X.filter(t=>t!==e))}},e.id))})]})}),Ce>1&&m.jsx("div",{className:"px-4 py-3 border-t "+(l?"border-gray-700 bg-gray-800":"border-gray-200 bg-gray-50"),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"text-sm "+(l?"text-gray-400":"text-gray-500"),children:["Showing ",De+1,"-",Math.min(Re,d.length)," of ",d.length," results"]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("button",{onClick:()=>re(1),disabled:1===se,className:"px-3 py-1 rounded border disabled:opacity-50 "+(l?"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:"First"}),m.jsx("button",{onClick:()=>re(Math.max(1,se-1)),disabled:1===se,className:"px-3 py-1 rounded border disabled:opacity-50 "+(l?"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Previous"}),m.jsxs("span",{className:"px-3 py-1 "+(l?"text-gray-300":"text-gray-700"),children:[se," of ",Ce]}),m.jsx("button",{onClick:()=>re(Math.min(Ce,se+1)),disabled:se===Ce,className:"px-3 py-1 rounded border disabled:opacity-50 "+(l?"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Next"}),m.jsx("button",{onClick:()=>re(Ce),disabled:se===Ce,className:"px-3 py-1 rounded border disabled:opacity-50 "+(l?"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Last"})]})]})})]}),O&&m.jsx(Q,{onClose:()=>q(!1),onCreate:e=>o(void 0,null,function*(){try{yield g.subscriptions.admin.createManualSubscription(e),u.success("Manual subscription created successfully"),q(!1),fe()}catch(t){u.error("Failed to create manual subscription")}})}),te&&m.jsx(W,{subscription:te,onClose:()=>ae(null),onUpdate:Se,onRefresh:fe})]})},z=({title:e,value:t,icon:a,color:s,trend:r,subtitle:l})=>{const{isDark:i}=x();return m.jsxs("div",{className:"p-4 rounded-lg border "+(i?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("div",{className:`p-2 rounded-lg ${{blue:"text-blue-500 bg-blue-100 dark:bg-blue-900/20",green:"text-green-500 bg-green-100 dark:bg-green-900/20",red:"text-red-500 bg-red-100 dark:bg-red-900/20",purple:"text-purple-500 bg-purple-100 dark:bg-purple-900/20",orange:"text-orange-500 bg-orange-100 dark:bg-orange-900/20"}[s]}`,children:m.jsx(a,{className:"text-lg"})}),void 0!==r&&m.jsxs("div",{className:"flex items-center text-xs",children:[(n=r,n>0?m.jsx(S,{className:"text-green-500"}):n<0?m.jsx(C,{className:"text-red-500"}):m.jsx($,{className:"text-gray-500"})),m.jsxs("span",{className:"ml-1 "+(r>0?"text-green-600":r<0?"text-red-600":"text-gray-600"),children:[Math.abs(r).toFixed(1),"%"]})]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium "+(i?"text-gray-400":"text-gray-500"),children:e}),m.jsx("p",{className:"text-lg font-semibold "+(i?"text-white":"text-gray-900"),children:t}),l&&m.jsx("p",{className:"text-xs "+(i?"text-gray-500":"text-gray-400"),children:l})]})]});var n},G=({title:e,value:t,icon:a,color:s,subtitle:r,onClick:l})=>{const{isDark:i}=x();return m.jsx("div",{className:"p-4 rounded-lg border cursor-pointer transition-all hover:shadow-md "+(i?"bg-gray-800 border-gray-700 hover:bg-gray-750":"bg-white border-gray-200 hover:bg-gray-50"),onClick:l,children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:`p-2 rounded-lg ${{blue:"text-blue-500 bg-blue-100 dark:bg-blue-900/20",green:"text-green-500 bg-green-100 dark:bg-green-900/20",orange:"text-orange-500 bg-orange-100 dark:bg-orange-900/20",purple:"text-purple-500 bg-purple-100 dark:bg-purple-900/20"}[s]}`,children:m.jsx(a,{className:"text-lg"})}),m.jsxs("div",{className:"text-right",children:[m.jsx("p",{className:"text-lg font-semibold "+(i?"text-white":"text-gray-900"),children:t}),m.jsx("p",{className:"text-xs "+(i?"text-gray-400":"text-gray-500"),children:e}),r&&m.jsx("p",{className:"text-xs "+(i?"text-gray-500":"text-gray-400"),children:r})]})]})})},Z=({field:e,label:t,sortField:a,sortDirection:s,onSort:r})=>{const{isDark:l}=x(),i=a===e;return m.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 "+(l?"text-gray-300":"text-gray-500"),onClick:()=>r(e,i&&"asc"===s?"desc":"asc"),children:m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx("span",{children:t}),i&&("asc"===s?m.jsx(S,{className:"text-xs"}):m.jsx(C,{className:"text-xs"}))]})})},K=({subscription:e,onUpdateStatus:t,onViewDetails:a,isSelected:s,onSelect:r})=>{const{isDark:l}=x(),i=e.trial_end_date&&new Date(e.trial_end_date)<=new Date(Date.now()+6048e5);return m.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750 "+(s?"bg-blue-50 dark:bg-blue-900/20":""),children:[m.jsx("td",{className:"px-4 py-3",children:m.jsx("input",{type:"checkbox",checked:s,onChange:t=>r(e.id,t.target.checked)})}),m.jsx("td",{className:"px-4 py-3",children:m.jsxs("div",{children:[m.jsx("div",{className:"font-medium "+(l?"text-white":"text-gray-900"),children:e.user_name||"Unknown User"}),m.jsx("div",{className:"text-sm "+(l?"text-gray-400":"text-gray-500"),children:e.user_email||`User ID: ${e.user_id}`}),e.id&&m.jsxs("div",{className:"text-xs "+(l?"text-gray-500":"text-gray-400"),children:["ID: ",e.id]})]})}),m.jsxs("td",{className:"px-4 py-3",children:[m.jsx("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${(e=>{switch(e){case"institution":return"text-purple-600 bg-purple-100 dark:text-purple-400 dark:bg-purple-900/20";case"family":return"text-blue-600 bg-blue-100 dark:text-blue-400 dark:bg-blue-900/20";case"student":return"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900/20";default:return"text-gray-600 bg-gray-100 dark:text-gray-400 dark:bg-gray-900/20"}})(e.plan_id)}`,children:e.plan_name}),m.jsx("div",{className:"text-xs mt-1 "+(l?"text-gray-400":"text-gray-500"),children:e.billing_cycle})]}),m.jsx("td",{className:"px-4 py-3",children:m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${(e=>{switch(e){case"active":return"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900/20";case"trial":return"text-blue-600 bg-blue-100 dark:text-blue-400 dark:bg-blue-900/20";case"cancelled":default:return"text-gray-600 bg-gray-100 dark:text-gray-400 dark:bg-gray-900/20";case"expired":return"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900/20";case"suspended":return"text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900/20"}})(e.status)}`,children:e.status}),i&&m.jsx(D,{className:"text-orange-500 text-sm",title:"Trial expiring soon"})]})}),m.jsx("td",{className:"px-4 py-3",children:m.jsxs("div",{className:"text-sm "+(l?"text-gray-300":"text-gray-900"),children:[m.jsxs("div",{children:["Start: ",new Date(e.subscription_start_date).toLocaleDateString()]}),m.jsxs("div",{children:["End: ",new Date(e.subscription_end_date).toLocaleDateString()]}),e.trial_end_date&&m.jsxs("div",{className:"text-xs "+(i?"text-orange-600":l?"text-gray-400":"text-gray-500"),children:["Trial: ",new Date(e.trial_end_date).toLocaleDateString()]})]})}),m.jsx("td",{className:"px-4 py-3",children:m.jsxs("div",{className:"text-sm "+(l?"text-gray-300":"text-gray-900"),children:[m.jsxs("div",{className:"font-medium",children:["R","monthly"===e.billing_cycle?e.price_monthly:e.price_annual]}),m.jsx("div",{className:"text-xs "+(l?"text-gray-400":"text-gray-500"),children:e.payment_method}),m.jsx("div",{className:"text-xs "+(l?"text-gray-400":"text-gray-500"),children:e.auto_renew?"Auto-renew":"Manual"})]})}),m.jsx("td",{className:"px-4 py-3",children:m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("button",{onClick:()=>a(e),className:"text-blue-500 hover:text-blue-600",title:"View Details",children:m.jsx(R,{})}),m.jsxs("select",{value:e.status,onChange:a=>t(e.id,a.target.value),className:"text-xs px-2 py-1 rounded border "+(l?"bg-gray-700 border-gray-600 text-gray-300":"bg-white border-gray-300 text-gray-700"),children:[m.jsx("option",{value:"active",children:"Active"}),m.jsx("option",{value:"trial",children:"Trial"}),m.jsx("option",{value:"cancelled",children:"Cancelled"}),m.jsx("option",{value:"expired",children:"Expired"}),m.jsx("option",{value:"suspended",children:"Suspended"})]})]})})]})},Q=({onClose:e,onCreate:t})=>{const{isDark:a}=x(),[s,r]=c.useState({userId:"",userEmail:"",planId:"student",billingCycle:"monthly",duration:30,startDate:(new Date).toISOString().split("T")[0],trialDays:0,autoRenew:!0,paymentMethod:"manual",notes:""});return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:e}),m.jsxs("div",{className:"relative max-w-md w-full mx-4 p-6 rounded-xl "+(a?"bg-gray-800":"bg-white"),children:[m.jsx("h2",{className:"text-xl font-bold mb-4 "+(a?"text-white":"text-gray-900"),children:"Create Manual Subscription"}),m.jsxs("form",{onSubmit:e=>{e.preventDefault(),t(s)},className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("input",{type:"text",placeholder:"User ID",value:s.userId,onChange:e=>r(d(n({},s),{userId:e.target.value})),className:"px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),m.jsx("input",{type:"email",placeholder:"User Email",value:s.userEmail,onChange:e=>r(d(n({},s),{userEmail:e.target.value})),className:"px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")})]}),m.jsxs("select",{value:s.planId,onChange:e=>r(d(n({},s),{planId:e.target.value})),className:"w-full px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"),children:[m.jsx("option",{value:"student",children:"Student Plan"}),m.jsx("option",{value:"family",children:"Family Plan"}),m.jsx("option",{value:"institution",children:"Institution Plan"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("select",{value:s.billingCycle,onChange:e=>r(d(n({},s),{billingCycle:e.target.value})),className:"px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"),children:[m.jsx("option",{value:"monthly",children:"Monthly"}),m.jsx("option",{value:"annual",children:"Annual"})]}),m.jsx("input",{type:"number",placeholder:"Duration (days)",value:s.duration,onChange:e=>r(d(n({},s),{duration:parseInt(e.target.value)})),className:"px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"),required:!0})]}),m.jsx("input",{type:"date",value:s.startDate,onChange:e=>r(d(n({},s),{startDate:e.target.value})),className:"w-full px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("input",{type:"number",placeholder:"Trial Days",value:s.trialDays,onChange:e=>r(d(n({},s),{trialDays:parseInt(e.target.value)})),className:"px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),m.jsxs("select",{value:s.paymentMethod,onChange:e=>r(d(n({},s),{paymentMethod:e.target.value})),className:"px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"),children:[m.jsx("option",{value:"manual",children:"Manual"}),m.jsx("option",{value:"credit_card",children:"Credit Card"}),m.jsx("option",{value:"payfast",children:"PayFast"}),m.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("input",{type:"checkbox",id:"autoRenew",checked:s.autoRenew,onChange:e=>r(d(n({},s),{autoRenew:e.target.checked}))}),m.jsx("label",{htmlFor:"autoRenew",className:"text-sm "+(a?"text-gray-300":"text-gray-700"),children:"Auto-renew subscription"})]}),m.jsx("textarea",{placeholder:"Notes (optional)",value:s.notes,onChange:e=>r(d(n({},s),{notes:e.target.value})),className:"w-full px-3 py-2 rounded border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"),rows:"3"}),m.jsxs("div",{className:"flex space-x-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 rounded bg-gray-500 text-white hover:bg-gray-600",children:"Cancel"}),m.jsx("button",{type:"submit",className:"flex-1 py-2 px-4 rounded bg-blue-500 text-white hover:bg-blue-600",children:"Create Subscription"})]})]})]})]})},W=({subscription:e,onClose:t,onUpdate:a,onRefresh:s})=>{const{isDark:r}=x();return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:t}),m.jsxs("div",{className:"relative max-w-4xl w-full mx-4 p-6 rounded-xl "+(r?"bg-gray-800":"bg-white"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h2",{className:"text-xl font-bold "+(r?"text-white":"text-gray-900"),children:"Subscription Details"}),m.jsx("button",{onClick:t,className:"p-2 rounded-lg "+(r?"hover:bg-gray-700":"hover:bg-gray-100"),children:m.jsx(P,{className:r?"text-gray-400":"text-gray-500"})})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold mb-4 "+(r?"text-white":"text-gray-900"),children:"User Information"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"Name"}),m.jsx("p",{className:""+(r?"text-white":"text-gray-900"),children:e.user_name||"Unknown User"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"Email"}),m.jsx("p",{className:""+(r?"text-white":"text-gray-900"),children:e.user_email||"No email"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"User ID"}),m.jsx("p",{className:""+(r?"text-white":"text-gray-900"),children:e.user_id})]})]})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold mb-4 "+(r?"text-white":"text-gray-900"),children:"Subscription Details"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"Plan"}),m.jsx("p",{className:""+(r?"text-white":"text-gray-900"),children:e.plan_name})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"Status"}),m.jsx("p",{className:""+(r?"text-white":"text-gray-900"),children:e.status})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"Billing Cycle"}),m.jsx("p",{className:""+(r?"text-white":"text-gray-900"),children:e.billing_cycle})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium "+(r?"text-gray-400":"text-gray-500"),children:"Price"}),m.jsxs("p",{className:""+(r?"text-white":"text-gray-900"),children:["R","monthly"===e.billing_cycle?e.price_monthly:e.price_annual]})]})]})]})]}),m.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[m.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Close"}),m.jsx("button",{onClick:()=>{s(),t()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Refresh & Close"})]})]})]})},Y=()=>{const{isDark:e}=x(),{user:t}=A(),{subscription:a,getCurrentPlan:s,getDaysRemaining:r,getSubscriptionStatus:l,getNextBillingAmount:i,getNextBillingDate:b,getUsagePercentage:h,plans:p,updateUsage:y,usage:v,error:f,lastUpdated:N}=T(),w=J(),[_,k]=c.useState("subscription"),[S,C]=c.useState(0),[D,R]=c.useState(!0),[P,$]=c.useState({recipients:[],subject:"",message:"",invoiceType:"invoice",amount:"",dueDate:"",items:[{description:"",quantity:1,price:0}]}),[z,G]=c.useState([]),[Z,K]=c.useState(!1),[Q,W]=c.useState(!1),Y=s(),X=r(),ee=l(),te=i();b();const ae={plan:(null==Y?void 0:Y.name)||"Free Plan",status:"active"===ee?"Active":"trial"===ee?"Trial":"trial_expired"===ee?"Trial Expired":"expiring_soon"===ee?"Expiring Soon":"cancelled"===ee?"Cancelled":"Inactive",nextBilling:(null==a?void 0:a.subscription_end_date)?new Date(a.subscription_end_date).toLocaleDateString():"N/A",amount:te>0?`R${te}/${(null==a?void 0:a.billing_cycle)||"month"}`:"Free",billingCycle:(null==a?void 0:a.billing_cycle)||"monthly",autoRenew:(null==a?void 0:a.auto_renew)||!1,paymentMethod:(null==a?void 0:a.payment_method)||"none",trialEndDate:(null==a?void 0:a.trial_end_date)?new Date(a.trial_end_date).toLocaleDateString():null,features:[`Up to ${-1===(null==Y?void 0:Y.features.maxChildren)?"unlimited":null==Y?void 0:Y.features.maxChildren} children`,`${null==Y?void 0:Y.features.maxFileSize}MB file uploads`,`${null==Y?void 0:Y.features.storage}MB storage`,(null==Y?void 0:Y.features.messaging)?"Parent-teacher messaging":"Basic communication","advanced"===(null==Y?void 0:Y.features.analytics)?"Advanced analytics":"enterprise"===(null==Y?void 0:Y.features.analytics)?"Enterprise analytics":"Basic reports",(null==Y?void 0:Y.features.ai_grading)?"AI-powered grading":"Manual grading only",(null==Y?void 0:Y.features.priority_support)?"Priority support":"Standard support"]},se=[{id:"subscription",label:"Subscription",icon:M},{id:"payments",label:"Payments",icon:F},{id:"proofs",label:"Payment Proofs",icon:I},{id:"invoices",label:"Invoices",icon:E},..."admin"===(null==t?void 0:t.role)||"admin"===(null==t?void 0:t.userType)?[{id:"send-invoices",label:"Send Invoices/Receipts",icon:U},{id:"enhanced-subscriptions",label:"Enhanced Subscriptions",icon:j}]:[],{id:"history",label:"History",icon:L}];c.useEffect(()=>{o(void 0,null,function*(){var e;if(t)try{let s;R(!0),s="parent"===t.role?yield g.children.getByParent(t.id):yield g.children.getAll();const r=(null==(e=s.data)?void 0:e.children)||s.data||[],l=Array.isArray(r)?r.length:0;C(l),a&&a.usage&&a.usage.children!==l&&y({children:l})}catch(s){}finally{R(!1)}})},[t,a,y]);const re=e=>{const t=e.target.files[0];t&&u.success(`Payment proof "${t.name}" uploaded successfully!`)},le=c.useCallback(()=>o(void 0,null,function*(){if("admin"===(null==t?void 0:t.role)||"admin"===(null==t?void 0:t.userType))try{K(!0);const e=yield g.users.getAll();G(e.data.users||[])}catch(e){u.error("Failed to load users")}finally{K(!1)}}),[t]),ie=(e,t)=>{$(a=>d(n({},a),{[e]:t}))},ne=()=>{$(e=>d(n({},e),{items:[...e.items,{description:"",quantity:1,price:0}]}))},de=(e,t,a)=>{$(s=>d(n({},s),{items:s.items.map((s,r)=>r===e?d(n({},s),{[t]:a}):s)}))},oe=()=>P.items.reduce((e,t)=>e+t.quantity*t.price,0).toFixed(2),ce=()=>o(void 0,null,function*(){if(P.recipients.length)if(P.subject.trim())try{W(!0);d(n({},P),{totalAmount:oe(),sentBy:t.id,sentAt:(new Date).toISOString()});yield new Promise(e=>setTimeout(e,2e3)),u.success(`${"invoice"===P.invoiceType?"Invoice":"Receipt"} sent successfully to ${P.recipients.length} recipient(s)!`),$({recipients:[],subject:"",message:"",invoiceType:"invoice",amount:"",dueDate:"",items:[{description:"",quantity:1,price:0}]})}catch(e){u.error("Failed to send invoice/receipt")}finally{W(!1)}else u.error("Please enter a subject");else u.error("Please select at least one recipient")});c.useEffect(()=>{"send-invoices"!==_||"admin"!==(null==t?void 0:t.role)&&"admin"!==(null==t?void 0:t.userType)||le()},[_,t,le]);return m.jsx("div",{className:"min-h-screen transition-colors "+(e?"bg-gray-900":"bg-gray-50"),children:m.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 pt-20 md:pt-6",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-3xl font-bold mb-2 "+(e?"text-white":"text-gray-900"),children:"Account Management"}),m.jsx("p",{className:""+(e?"text-gray-400":"text-gray-600"),children:"Manage your subscription, payments, and account settings"})]}),m.jsx("div",{className:"border-b mb-6 "+(e?"border-gray-700":"border-gray-200"),children:m.jsx("div",{className:"overflow-x-auto scrollbar-hide",children:m.jsx("nav",{className:"flex space-x-8 min-w-max",children:se.map(t=>{const a=t.icon;return m.jsxs("button",{onClick:()=>k(t.id),className:"flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap "+(_===t.id?e?"border-blue-400 text-blue-400":"border-blue-500 text-blue-600":e?"border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[m.jsx(a,{}),m.jsx("span",{children:t.label})]},t.id)})})})}),"subscription"===_&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"rounded-lg p-6 shadow-lg "+(e?"bg-gray-800":"bg-white"),children:[m.jsx("h3",{className:"text-xl font-semibold mb-4 "+(e?"text-white":"text-gray-900"),children:"Current Subscription"}),m.jsxs("div",{className:"rounded-lg p-4 border "+(e?"bg-purple-900/20 border-purple-700/30":"bg-purple-50 border-purple-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(M,{className:"text-yellow-500"}),m.jsx("span",{className:"font-semibold text-lg "+(e?"text-white":"text-gray-900"),children:ae.plan}),m.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("Active"===ae.status?"bg-green-100 text-green-800":"Trial"===ae.status?"bg-blue-100 text-blue-800":"Trial Expired"===ae.status?"bg-red-100 text-red-800":"Expiring Soon"===ae.status?"bg-yellow-100 text-yellow-800":(ae.status,"bg-gray-100 text-gray-800")),children:ae.status}),f&&m.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs font-medium",children:"Demo Mode"})]}),m.jsxs("div",{className:"text-right",children:[m.jsx("div",{className:"font-bold text-xl "+(e?"text-purple-400":"text-purple-600"),children:ae.amount}),m.jsx("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:"Trial"===ae.status&&ae.trialEndDate?`Trial ends: ${ae.trialEndDate}`:`Next billing: ${ae.nextBilling}`}),ae.autoRenew&&m.jsx("div",{className:"text-xs text-gray-500",children:"Auto-renew enabled"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[m.jsxs("div",{children:[m.jsx("div",{className:"text-xs font-medium mb-1 "+(e?"text-gray-400":"text-gray-600"),children:"Billing Cycle"}),m.jsx("div",{className:"text-sm "+(e?"text-white":"text-gray-900"),children:"annual"===ae.billingCycle?"Annual":"Monthly"})]}),m.jsxs("div",{children:[m.jsx("div",{className:"text-xs font-medium mb-1 "+(e?"text-gray-400":"text-gray-600"),children:"Payment Method"}),m.jsx("div",{className:"text-sm "+(e?"text-white":"text-gray-900"),children:"payfast"===ae.paymentMethod?"PayFast":"credit_card"===ae.paymentMethod?"Credit Card":"bank_transfer"===ae.paymentMethod?"Bank Transfer":"None"})]})]}),null!==X&&m.jsx("div",{className:"text-sm mb-3 p-2 rounded "+(X<=7?e?"bg-red-900/30 text-red-400":"bg-red-50 text-red-700":X<=30?e?"bg-yellow-900/30 text-yellow-400":"bg-yellow-50 text-yellow-700":e?"bg-green-900/30 text-green-400":"bg-green-50 text-green-700"),children:X>0?`${X} days remaining`:0===X?"Expires today":`Expired ${Math.abs(X)} days ago`}),N&&m.jsxs("div",{className:`text-xs ${e?"text-gray-500":"text-gray-400"} mb-3`,children:["Last updated: ",N.toLocaleString()]}),m.jsx("div",{className:"space-y-1",children:ae.features.map((t,a)=>m.jsxs("div",{className:"flex items-center space-x-2 text-sm "+(e?"text-gray-300":"text-gray-700"),children:[m.jsx(B,{className:"text-yellow-400 text-xs"}),m.jsx("span",{children:t})]},a))})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-6",children:[m.jsxs("div",{className:"p-4 rounded-lg border "+(e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("div",{className:"text-2xl font-bold "+(e?"text-green-400":"text-green-600"),children:D?m.jsx("div",{className:"animate-pulse",children:"-"}):`${S}/${-1===(null==Y?void 0:Y.features.maxChildren)?"∞":null==Y?void 0:Y.features.maxChildren}`}),m.jsx(O,{className:"text-lg "+(e?"text-gray-500":"text-gray-400")})]}),m.jsx("div",{className:`text-sm ${e?"text-gray-400":"text-gray-600"} mb-2`,children:"Children Added"}),-1!==(null==Y?void 0:Y.features.maxChildren)&&m.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:m.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,S/((null==Y?void 0:Y.features.maxChildren)||1)*100)}%`}})})]}),m.jsxs("div",{className:"p-4 rounded-lg border "+(e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"text-2xl font-bold "+(e?"text-blue-400":"text-blue-600"),children:[(null==v?void 0:v.storage)||0,"MB"]}),m.jsx(q,{className:"text-lg "+(e?"text-gray-500":"text-gray-400")})]}),m.jsxs("div",{className:`text-sm ${e?"text-gray-400":"text-gray-600"} mb-2`,children:["Storage Used (",null==Y?void 0:Y.features.storage,"MB limit)"]}),m.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:m.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${h?h("storage"):0}%`}})})]}),m.jsxs("div",{className:"p-4 rounded-lg border "+(e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("div",{className:"text-2xl font-bold "+(e?"text-purple-400":"text-purple-600"),children:(null==v?void 0:v.homework)||0}),m.jsx(E,{className:"text-lg "+(e?"text-gray-500":"text-gray-400")})]}),m.jsxs("div",{className:`text-sm ${e?"text-gray-400":"text-gray-600"} mb-2`,children:["Homework Assigned",-1!==(null==Y?void 0:Y.features.maxHomework)&&` (${null==Y?void 0:Y.features.maxHomework} limit)`]}),-1!==(null==Y?void 0:Y.features.maxHomework)&&m.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:m.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${h?h("homework"):0}%`}})})]}),m.jsxs("div",{className:"p-4 rounded-lg border "+(e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("div",{className:"text-2xl font-bold "+(e?"text-orange-400":"text-orange-600"),children:(null==v?void 0:v.activities)||0}),m.jsx(B,{className:"text-lg "+(e?"text-gray-500":"text-gray-400")})]}),m.jsxs("div",{className:`text-sm ${e?"text-gray-400":"text-gray-600"} mb-2`,children:["Activities Created",-1!==(null==Y?void 0:Y.features.maxActivities)&&` (${null==Y?void 0:Y.features.maxActivities} limit)`]}),-1!==(null==Y?void 0:Y.features.maxActivities)&&m.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:m.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:`${h?h("activities"):0}%`}})})]})]}),"free"!==(null==Y?void 0:Y.id)&&m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[m.jsxs("div",{className:"p-4 rounded-lg border "+(e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("div",{className:"text-xl font-bold "+(e?"text-indigo-400":"text-indigo-600"),children:(null==v?void 0:v.ai_usage)||0}),m.jsx(V,{className:"text-lg "+(e?"text-gray-500":"text-gray-400")})]}),m.jsx("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:"AI Grading Sessions This Month"})]}),(null==Y?void 0:Y.features.api_access)&&m.jsxs("div",{className:"p-4 rounded-lg border "+(e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("div",{className:"text-xl font-bold "+(e?"text-pink-400":"text-pink-600"),children:(null==v?void 0:v.api_calls)||0}),m.jsx(q,{className:"text-lg "+(e?"text-gray-500":"text-gray-400")})]}),m.jsx("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:"API Calls This Month"})]})]})]}),m.jsxs("div",{className:"rounded-lg p-6 shadow-lg "+(e?"bg-gray-800":"bg-white"),children:[m.jsx("h3",{className:"text-xl font-semibold mb-4 "+(e?"text-white":"text-gray-900"),children:"Change Plan"}),m.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:Object.values(p).map((t,a)=>{const s=t.id===(null==Y?void 0:Y.id),r=s?e?"border-purple-400 bg-purple-900/20":"border-purple-500 bg-purple-50":e?"border-gray-600 bg-gray-700/50 hover:border-purple-500":"border-gray-200 bg-white hover:border-purple-300";return m.jsxs("div",{className:`border rounded-xl p-6 relative transition-all transform hover:scale-105 ${r} ${t.popular?"ring-2 ring-purple-500 shadow-lg":"shadow-md"}`,children:[t.popular&&m.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:m.jsx("span",{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-1 rounded-full text-xs font-medium shadow-lg",children:"⭐ Most Popular"})}),m.jsxs("div",{className:"text-center mb-6",children:[m.jsx("h4",{className:"font-bold text-xl mb-2 "+(e?"text-white":"text-gray-900"),children:t.name}),m.jsx("p",{className:"text-sm mb-4 "+(e?"text-gray-400":"text-gray-600"),children:t.description}),m.jsxs("div",{className:"mb-4",children:[m.jsxs("span",{className:"text-4xl font-bold "+(e?"text-white":"text-gray-900"),children:["R",t.price]}),m.jsxs("span",{className:"text-lg "+(e?"text-gray-400":"text-gray-600"),children:["/",t.period]})]})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("h5",{className:"font-semibold mb-3 "+(e?"text-white":"text-gray-900"),children:"What's included:"}),m.jsxs("ul",{className:"space-y-2",children:[m.jsxs("li",{className:"flex items-start space-x-2 text-sm "+(e?"text-gray-300":"text-gray-700"),children:[m.jsx(B,{className:"text-green-500 text-xs mt-1 flex-shrink-0"}),m.jsxs("span",{children:["Up to ",-1===t.features.maxChildren?"unlimited":t.features.maxChildren," children"]})]}),m.jsxs("li",{className:"flex items-start space-x-2 text-sm "+(e?"text-gray-300":"text-gray-700"),children:[m.jsx(B,{className:"text-green-500 text-xs mt-1 flex-shrink-0"}),m.jsxs("span",{children:[t.features.maxFileSize,"MB file uploads"]})]}),m.jsxs("li",{className:"flex items-start space-x-2 text-sm "+(e?"text-gray-300":"text-gray-700"),children:[m.jsx(B,{className:"text-green-500 text-xs mt-1 flex-shrink-0"}),m.jsxs("span",{children:[t.features.storage,"MB total storage"]})]}),m.jsxs("li",{className:"flex items-start space-x-2 text-sm "+(e?"text-gray-300":"text-gray-700"),children:[m.jsx(B,{className:"text-green-500 text-xs mt-1 flex-shrink-0"}),m.jsx("span",{children:t.features.messaging?"Parent-teacher messaging":"Basic communication"})]}),m.jsxs("li",{className:"flex items-start space-x-2 text-sm "+(e?"text-gray-300":"text-gray-700"),children:[m.jsx(B,{className:"text-green-500 text-xs mt-1 flex-shrink-0"}),m.jsx("span",{children:"advanced"===t.features.analytics?"Advanced analytics":"enterprise"===t.features.analytics?"Enterprise analytics":"Basic analytics"})]})]})]}),m.jsx("button",{className:"w-full py-3 px-4 rounded-lg font-medium transition-all transform hover:scale-105 "+(s?e?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-gray-400 text-gray-700 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-purple-600 text-white hover:from-purple-600 hover:to-purple-700"),disabled:s,onClick:()=>{s||w(`/checkout?plan=${t.id}`)},children:s?"✅ Current Plan":`Upgrade to ${t.name}`})]},a)})})]})]}),"proofs"===_&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"rounded-lg p-6 shadow-lg "+(e?"bg-gray-800":"bg-white"),children:[m.jsx("h3",{className:"text-xl font-semibold mb-4 "+(e?"text-white":"text-gray-900"),children:"Upload Payment Proof"}),m.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors "+(e?"border-gray-600 bg-gray-700/30 hover:border-gray-500":"border-gray-300 bg-gray-50 hover:border-gray-400"),children:[m.jsx(I,{className:"mx-auto text-4xl mb-4 text-gray-400"}),m.jsx("p",{className:"mb-4 "+(e?"text-gray-300":"text-gray-600"),children:"Upload proof of payment (PNG, JPG, PDF)"}),m.jsx("input",{type:"file",accept:".png,.jpg,.jpeg,.pdf",onChange:re,className:"hidden",id:"payment-proof"}),m.jsx("label",{htmlFor:"payment-proof",className:"inline-block py-2 px-4 rounded-lg font-medium cursor-pointer transition-colors bg-blue-600 text-white hover:bg-blue-700",children:"Choose File"})]})]}),m.jsxs("div",{className:"rounded-lg p-6 shadow-lg "+(e?"bg-gray-800":"bg-white"),children:[m.jsx("h3",{className:"text-xl font-semibold mb-4 "+(e?"text-white":"text-gray-900"),children:"Recent Uploads"}),m.jsx("div",{className:"space-y-3",children:[{name:"Payment_July_2025.pdf",date:"2025-07-01",status:"Verified"},{name:"Bank_Transfer_June.jpg",date:"2025-06-01",status:"Pending"}].map((t,a)=>m.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg "+(e?"bg-gray-700/50":"bg-gray-50"),children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(E,{className:e?"text-gray-400":"text-gray-500"}),m.jsxs("div",{children:[m.jsx("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:t.name}),m.jsx("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:t.date})]})]}),m.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("Verified"===t.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:t.status})]},a))})]})]}),"send-invoices"===_&&m.jsx("div",{className:"space-y-6",children:m.jsxs("div",{className:"rounded-lg p-6 shadow-lg "+(e?"bg-gray-800":"bg-white"),children:[m.jsx("h3",{className:"text-xl font-semibold mb-4 "+(e?"text-white":"text-gray-900"),children:"Send Invoice/Receipt"}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-semibold mb-3 "+(e?"text-gray-200":"text-gray-700"),children:"Document Type"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:["invoice","receipt"].map(t=>m.jsx("button",{type:"button",onClick:()=>ie("invoiceType",t),className:"px-4 py-3 text-sm font-semibold rounded-xl transition-all duration-200 transform hover:scale-105 "+(P.invoiceType===t?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":e?"bg-gray-700/50 text-gray-300 hover:bg-gray-600/50 border-2 border-gray-600":"bg-gray-100/50 text-gray-600 hover:bg-gray-200/50 border-2 border-gray-200"),disabled:Q,children:"invoice"===t?"📄 Invoice":"🧾 Receipt"},t))})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-semibold mb-3 "+(e?"text-gray-200":"text-gray-700"),children:"Recipients *"}),Z?m.jsxs("div",{className:"p-4 rounded-lg text-center "+(e?"bg-gray-700/50":"bg-gray-50"),children:[m.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto mb-2"}),m.jsx("p",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:"Loading users..."})]}):m.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-lg "+(e?"border-gray-600 bg-gray-700/30":"border-gray-300 bg-gray-50"),children:z.map(t=>m.jsxs("label",{className:"flex items-center p-3 hover:bg-opacity-50 cursor-pointer transition-colors "+(e?"hover:bg-gray-600":"hover:bg-gray-200"),children:[m.jsx("input",{type:"checkbox",checked:P.recipients.includes(t.id),onChange:e=>{e.target.checked?ie("recipients",[...P.recipients,t.id]):ie("recipients",P.recipients.filter(e=>e!==t.id))},className:"mr-3 rounded",disabled:Q}),m.jsxs("div",{children:[m.jsx("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:t.name}),m.jsxs("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:[t.email," (",t.role,")"]})]})]},t.id))})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-semibold mb-3 "+(e?"text-gray-200":"text-gray-700"),children:"Subject *"}),m.jsx("input",{type:"text",value:P.subject,onChange:e=>ie("subject",e.target.value),placeholder:`Enter ${P.invoiceType} subject`,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all "+(e?"bg-gray-700/50 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"),disabled:Q})]}),m.jsxs("div",{className:"mb-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-3",children:[m.jsx("label",{className:"text-sm font-semibold "+(e?"text-gray-200":"text-gray-700"),children:"Items/Services"}),m.jsx("button",{type:"button",onClick:ne,className:"px-3 py-1 text-sm rounded-lg transition-colors bg-blue-600 text-white hover:bg-blue-700",disabled:Q,children:"+ Add Item"})]}),m.jsx("div",{className:"space-y-3",children:P.items.map((t,a)=>m.jsx("div",{className:"p-4 border rounded-lg "+(e?"border-gray-600 bg-gray-700/30":"border-gray-300 bg-gray-50"),children:m.jsxs("div",{className:"grid grid-cols-12 gap-3 items-center",children:[m.jsx("div",{className:"col-span-5",children:m.jsx("input",{type:"text",value:t.description,onChange:e=>de(a,"description",e.target.value),placeholder:"Item description",className:"w-full px-3 py-2 border rounded focus:ring-1 focus:ring-blue-500 text-sm "+(e?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"),disabled:Q})}),m.jsx("div",{className:"col-span-2",children:m.jsx("input",{type:"number",value:t.quantity,onChange:e=>de(a,"quantity",parseInt(e.target.value)||1),placeholder:"Qty",min:"1",className:"w-full px-3 py-2 border rounded focus:ring-1 focus:ring-blue-500 text-sm "+(e?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"),disabled:Q})}),m.jsx("div",{className:"col-span-3",children:m.jsx("input",{type:"number",value:t.price,onChange:e=>de(a,"price",parseFloat(e.target.value)||0),placeholder:"Price (R)",step:"0.01",min:"0",className:"w-full px-3 py-2 border rounded focus:ring-1 focus:ring-blue-500 text-sm "+(e?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"),disabled:Q})}),m.jsxs("div",{className:"col-span-2 text-center",children:[m.jsxs("div",{className:"text-sm font-medium "+(e?"text-white":"text-gray-900"),children:["R",(t.quantity*t.price).toFixed(2)]}),P.items.length>1&&m.jsx("button",{type:"button",onClick:()=>(e=>{$(t=>d(n({},t),{items:t.items.filter((t,a)=>a!==e)}))})(a),className:"text-red-500 hover:text-red-700 text-xs mt-1",disabled:Q,children:"Remove"})]})]})},a))}),m.jsx("div",{className:"mt-4 p-4 rounded-lg text-right "+(e?"bg-blue-900/20 border border-blue-700/30":"bg-blue-50 border border-blue-200"),children:m.jsxs("div",{className:"text-lg font-bold "+(e?"text-white":"text-gray-900"),children:["Total: R",oe()]})})]}),"invoice"===P.invoiceType&&m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-semibold mb-3 "+(e?"text-gray-200":"text-gray-700"),children:"Due Date"}),m.jsx("input",{type:"date",value:P.dueDate,onChange:e=>ie("dueDate",e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all "+(e?"bg-gray-700/50 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"),disabled:Q})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-semibold mb-3 "+(e?"text-gray-200":"text-gray-700"),children:"Additional Message (Optional)"}),m.jsx("textarea",{value:P.message,onChange:e=>ie("message",e.target.value),placeholder:"Add any additional notes or instructions...",rows:4,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none "+(e?"bg-gray-700/50 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"),disabled:Q})]}),m.jsx("div",{className:"flex justify-end",children:m.jsx("button",{onClick:ce,disabled:Q||!P.recipients.length||!P.subject.trim(),className:"px-6 py-3 rounded-lg font-medium flex items-center space-x-2 transition-all transform hover:scale-105 "+(!Q&&P.recipients.length&&P.subject.trim()?"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg":"bg-gray-400 text-white cursor-not-allowed"),children:Q?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),m.jsx("span",{children:"Sending..."})]}):m.jsxs(m.Fragment,{children:[m.jsx(U,{}),m.jsxs("span",{children:["Send ","invoice"===P.invoiceType?"Invoice":"Receipt"]})]})})})]})}),"enhanced-subscriptions"===_&&m.jsx(H,{}),["payments","invoices","history"].includes(_)&&m.jsxs("div",{className:"rounded-lg p-6 shadow-lg text-center py-12 "+(e?"bg-gray-800":"bg-white"),children:[m.jsx(q,{className:"mx-auto text-6xl mb-4 "+(e?"text-gray-500":"text-gray-400")}),m.jsx("h3",{className:"text-xl font-semibold mb-2 "+(e?"text-white":"text-gray-900"),children:"Coming Soon"}),m.jsx("p",{className:e?"text-gray-400":"text-gray-600",children:"This feature is under development and will be available soon."})]})]})})};export{Y as default};
