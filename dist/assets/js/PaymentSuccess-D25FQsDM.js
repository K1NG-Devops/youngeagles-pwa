import{r as e}from"./vendor-react-BHu_3aIX.js";import{u as t,d as s}from"./vendor-router-BfAStt8k.js";import{l as a,u as r,N as l,j as n,r as i,L as c,ai as m,a as x,n as d}from"./index-BetBoxhn.js";import"./vendor-utils-C_UPlz3V.js";const o=()=>{const{isDark:o}=a(),{user:g}=r(),{upgradePlan:u,plans:y}=l(),h=t(),[p]=s(),[b,f]=e.useState(!0),[j,N]=e.useState(null);return e.useEffect(()=>{const e=()=>{return e=void 0,t=null,s=function*(){try{const e=p.get("pf_payment_id"),t=p.get("amount_gross"),s=p.get("custom_str2"),a=p.get("custom_str1");if(!e||!s)throw new Error("Missing payment information");if(a&&(null==g?void 0:g.id)&&a!==g.id.toString())throw new Error("Payment user mismatch");if(N({paymentId:e,amount:parseFloat(t),planId:s,plan:y[s]}),s&&y[s]){if(!(yield u(s)).success)throw new Error("Failed to update subscription");d.success(`Successfully upgraded to ${y[s].name} plan!`)}f(!1),setTimeout(()=>{h("/management")},5e3)}catch(e){d.error(`Payment processing failed: ${e.message}`),f(!1),setTimeout(()=>{h("/management")},3e3)}},new Promise((a,r)=>{var l=e=>{try{i(s.next(e))}catch(t){r(t)}},n=e=>{try{i(s.throw(e))}catch(t){r(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,n);i((s=s.apply(e,t)).next())});var e,t,s};g&&e()},[g,p,u,y,h]),b?n.jsx("div",{className:"min-h-screen flex items-center justify-center "+(o?"bg-gray-900":"bg-gray-50"),children:n.jsxs("div",{className:"text-center",children:[n.jsx(i,{className:"text-6xl mx-auto mb-4 animate-spin "+(o?"text-blue-400":"text-blue-500")}),n.jsx("h2",{className:"text-2xl font-bold mb-2 "+(o?"text-white":"text-gray-900"),children:"Processing Payment..."}),n.jsx("p",{className:""+(o?"text-gray-400":"text-gray-600"),children:"Please wait while we confirm your payment"})]})}):n.jsx("div",{className:"min-h-screen flex items-center justify-center "+(o?"bg-gray-900":"bg-gray-50"),children:n.jsxs("div",{className:"max-w-md w-full mx-4 p-8 rounded-lg shadow-lg "+(o?"bg-gray-800":"bg-white"),children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx(c,{className:"text-6xl text-green-500 mx-auto mb-4"}),n.jsx("h1",{className:"text-2xl font-bold mb-2 "+(o?"text-white":"text-gray-900"),children:"Payment Successful!"}),n.jsx("p",{className:""+(o?"text-gray-400":"text-gray-600"),children:"Your subscription has been upgraded successfully"})]}),j&&n.jsxs("div",{className:"border rounded-lg p-4 mb-6 "+(o?"border-gray-700 bg-gray-700/50":"border-gray-200 bg-gray-50"),children:[n.jsx("h3",{className:"font-semibold mb-3 "+(o?"text-white":"text-gray-900"),children:"Payment Details"}),n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:""+(o?"text-gray-400":"text-gray-600"),children:"Payment ID:"}),n.jsx("span",{className:"font-mono "+(o?"text-gray-300":"text-gray-800"),children:j.paymentId})]}),j.plan&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:""+(o?"text-gray-400":"text-gray-600"),children:"Plan:"}),n.jsx("span",{className:"font-medium "+(o?"text-gray-300":"text-gray-800"),children:j.plan.name})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:""+(o?"text-gray-400":"text-gray-600"),children:"Amount:"}),n.jsxs("span",{className:"font-medium "+(o?"text-gray-300":"text-gray-800"),children:["R",j.amount]})]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:""+(o?"text-gray-400":"text-gray-600"),children:"Status:"}),n.jsx("span",{className:"text-green-600 font-medium",children:"Completed"})]})]})]}),(null==j?void 0:j.plan)&&n.jsxs("div",{className:"border rounded-lg p-4 mb-6 "+(o?"border-purple-700 bg-purple-900/20":"border-purple-200 bg-purple-50"),children:[n.jsxs("div",{className:"flex items-center mb-3",children:[n.jsx(m,{className:"text-yellow-500 mr-2"}),n.jsx("h3",{className:"font-semibold "+(o?"text-white":"text-gray-900"),children:"Your New Benefits"})]}),n.jsxs("ul",{className:"space-y-1 text-sm",children:[n.jsxs("li",{className:""+(o?"text-gray-300":"text-gray-700"),children:["• Up to ",-1===j.plan.features.maxChildren?"unlimited":j.plan.features.maxChildren," children"]}),n.jsxs("li",{className:""+(o?"text-gray-300":"text-gray-700"),children:["• ",j.plan.features.maxFileSize,"MB file uploads"]}),n.jsxs("li",{className:""+(o?"text-gray-300":"text-gray-700"),children:["• ",j.plan.features.storage,"MB total storage"]}),j.plan.features.messaging&&n.jsx("li",{className:""+(o?"text-gray-300":"text-gray-700"),children:"• Parent-teacher messaging"}),"advanced"===j.plan.features.analytics&&n.jsx("li",{className:""+(o?"text-gray-300":"text-gray-700"),children:"• Advanced analytics"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{onClick:()=>h("/management"),className:"w-full flex items-center justify-center py-3 px-4 rounded-lg font-medium transition-colors "+(o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:["Go to Account Management",n.jsx(x,{className:"ml-2"})]}),n.jsx("button",{onClick:()=>h("/dashboard"),className:"w-full py-3 px-4 rounded-lg font-medium transition-colors "+(o?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:"Back to Dashboard"})]}),n.jsx("p",{className:"text-center text-xs mt-4 "+(o?"text-gray-500":"text-gray-400"),children:"You'll be automatically redirected to Account Management in 5 seconds"})]})})};export{o as default};
