var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&d(e,a,t[a]);if(s)for(var a of s(t))l.call(t,a)&&d(e,a,t[a]);return e},i=(e,s)=>t(e,a(s)),c=(e,t,a)=>new Promise((s,r)=>{var l=e=>{try{n(a.next(e))}catch(t){r(t)}},d=e=>{try{n(a.throw(e))}catch(t){r(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,d);n((a=a.apply(e,t)).next())});import{r as o}from"./vendor-react-BHu_3aIX.js";import{u as m,l as x,j as p,C as h,A as g,n as y,O as u,_ as b,aD as j,J as f,r as v,L as N,aG as w,aX as _,q as k,Z as P,D as S,E as D,av as A}from"./index-BetBoxhn.js";import{u as F}from"./vendor-router-BfAStt8k.js";import"./vendor-utils-C_UPlz3V.js";const R=()=>{const e=F(),{user:t}=m(),{isDark:a}=x(),[s,r]=o.useState([]),[l,d]=o.useState([]),[R,$]=o.useState(null),[C,T]=o.useState(!0),[O,E]=o.useState(null),[Z,L]=o.useState(!1),[I,J]=o.useState(null),[z,B]=o.useState(null),[M,W]=o.useState({status:"all",search:"",dateFrom:"",dateTo:""});if(o.useEffect(()=>{!t||"admin"!==t.role&&"admin"!==t.userType||q()},[t]),o.useEffect(()=>{G()},[s,M]),!t||"admin"!==t.role&&"admin"!==t.userType)return p.jsx("div",{className:"flex items-center justify-center min-h-screen "+(a?"bg-gray-900":"bg-gray-50"),children:p.jsxs("div",{className:"text-center",children:[p.jsx(h,{className:"text-6xl text-red-500 mx-auto mb-4"}),p.jsx("h2",{className:"text-2xl font-bold mb-2 "+(a?"text-white":"text-gray-900"),children:"Access Denied"}),p.jsx("p",{className:""+(a?"text-gray-300":"text-gray-600"),children:"You need admin privileges to access this page."})]})});const q=()=>c(void 0,null,function*(){try{T(!0);try{const e=yield g.payments.getAdminSummary();$(e.data.summary)}catch(e){}const t=(yield g.payments.getAllProofs()).data.proofs||[];r(t)}catch(e){r([{id:1,parent_name:"John Smith",child_name:"Emma Smith",amount:150,payment_date:"2024-01-15",reference_number:"REF123456",payment_method:"bank_transfer",status:"pending",submitted_at:"2024-01-16T10:30:00Z",proof_file_url:"/uploads/proof1.pdf"},{id:2,parent_name:"Mary Johnson",child_name:"Michael Johnson",amount:200,payment_date:"2024-01-14",reference_number:"REF789012",payment_method:"eft",status:"pending",submitted_at:"2024-01-15T14:20:00Z",proof_file_url:"/uploads/proof2.jpg"},{id:3,parent_name:"Sarah Wilson",child_name:"Lisa Wilson",amount:175,payment_date:"2024-01-13",reference_number:"REF345678",payment_method:"bank_transfer",status:"approved",submitted_at:"2024-01-14T09:15:00Z",approved_at:"2024-01-14T11:30:00Z",proof_file_url:"/uploads/proof3.pdf"},{id:4,parent_name:"David Brown",child_name:"Tom Brown",amount:125,payment_date:"2024-01-12",reference_number:"REF901234",payment_method:"cash_deposit",status:"rejected",submitted_at:"2024-01-13T16:45:00Z",rejected_at:"2024-01-13T18:00:00Z",rejection_reason:"Receipt unclear, please resubmit with clearer image",proof_file_url:"/uploads/proof4.jpg"}]),y.info("Showing demo data - Admin payment review endpoint not yet implemented")}finally{T(!1)}}),G=()=>{let e=[...s];if("all"!==M.status&&(e=e.filter(e=>e.status===M.status)),M.search){const t=M.search.toLowerCase();e=e.filter(e=>{var a,s,r;return(null==(a=e.parent_name)?void 0:a.toLowerCase().includes(t))||(null==(s=e.child_name)?void 0:s.toLowerCase().includes(t))||(null==(r=e.reference_number)?void 0:r.toLowerCase().includes(t))})}M.dateFrom&&(e=e.filter(e=>new Date(e.payment_date)>=new Date(M.dateFrom))),M.dateTo&&(e=e.filter(e=>new Date(e.payment_date)<=new Date(M.dateTo))),d(e)},U=e=>c(void 0,null,function*(){try{J(`approve-${e}`),yield g.payments.approveProof(e),r(t=>t.map(t=>t.id===e?i(n({},t),{status:"approved",approved_at:(new Date).toISOString()}):t)),y.success("Payment proof approved successfully!"),L(!1)}catch(t){y.error("Failed to approve payment proof")}finally{J(null)}}),V=(e,t)=>c(void 0,null,function*(){try{J(`reject-${e}`),yield g.payments.rejectProof(e,{reason:t}),r(a=>a.map(a=>a.id===e?i(n({},a),{status:"rejected",rejected_at:(new Date).toISOString(),rejection_reason:t||"No reason provided"}):a)),y.success("Payment proof rejected"),L(!1)}catch(a){y.error("Failed to reject payment proof")}finally{J(null)}}),X=e=>{switch(e){case"approved":return a?"text-green-400 bg-green-900/20 border-green-800":"text-green-600 bg-green-50 border-green-200";case"rejected":return a?"text-red-400 bg-red-900/20 border-red-800":"text-red-600 bg-red-50 border-red-200";default:return a?"text-yellow-400 bg-yellow-900/20 border-yellow-800":"text-yellow-600 bg-yellow-50 border-yellow-200"}},Y=e=>{switch(e){case"approved":return p.jsx(N,{className:"w-4 h-4"});case"rejected":return p.jsx(w,{className:"w-4 h-4"});default:return p.jsx(v,{className:"w-4 h-4"})}},H=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),K=e=>new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR"}).format(e);return C?p.jsx("div",{className:"flex items-center justify-center min-h-screen "+(a?"bg-gray-900":"bg-gray-50"),children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),p.jsx("p",{className:""+(a?"text-gray-300":"text-gray-600"),children:"Loading payment proofs..."})]})}):p.jsxs("div",{className:"min-h-screen "+(a?"bg-gray-900":"bg-gray-50"),children:[p.jsx(u,{}),p.jsx("div",{className:"pt-20 pb-4",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsxs("div",{className:"mb-8",children:[p.jsx("div",{className:"flex items-center justify-between mb-4",children:p.jsxs("button",{onClick:()=>e("/dashboard"),className:"inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-200 "+(a?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[p.jsx(b,{className:"w-4 h-4 mr-2"}),"Back to Admin Dashboard"]})}),p.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-6",children:[p.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center",children:[p.jsx(j,{className:"mr-3"}),"Payment Proof Review"]}),p.jsx("p",{className:"text-blue-100",children:"Review and approve payment proofs submitted by parents"})]})]}),p.jsx("div",{className:"p-6 rounded-xl shadow-sm border mb-6 "+(a?"bg-gray-800 border-gray-700":"bg-white border-gray-100"),children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2 "+(a?"text-gray-300":"text-gray-700"),children:"Status"}),p.jsxs("select",{value:M.status,onChange:e=>W(t=>i(n({},t),{status:e.target.value})),className:"w-full p-2 rounded-lg border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"),children:[p.jsx("option",{value:"all",children:"All Status"}),p.jsx("option",{value:"pending",children:"Pending"}),p.jsx("option",{value:"approved",children:"Approved"}),p.jsx("option",{value:"rejected",children:"Rejected"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2 "+(a?"text-gray-300":"text-gray-700"),children:"Search"}),p.jsxs("div",{className:"relative",children:[p.jsx(f,{className:"absolute left-3 top-3 w-4 h-4 "+(a?"text-gray-400":"text-gray-500")}),p.jsx("input",{type:"text",placeholder:"Parent name, child, reference...",value:M.search,onChange:e=>W(t=>i(n({},t),{search:e.target.value})),className:"w-full pl-10 p-2 rounded-lg border "+(a?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2 "+(a?"text-gray-300":"text-gray-700"),children:"From Date"}),p.jsx("input",{type:"date",value:M.dateFrom,onChange:e=>W(t=>i(n({},t),{dateFrom:e.target.value})),className:"w-full p-2 rounded-lg border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900")})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium mb-2 "+(a?"text-gray-300":"text-gray-700"),children:"To Date"}),p.jsx("input",{type:"date",value:M.dateTo,onChange:e=>W(t=>i(n({},t),{dateTo:e.target.value})),className:"w-full p-2 rounded-lg border "+(a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900")})]})]})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[p.jsx("div",{className:`p-4 rounded-lg ${a?"bg-gray-800":"bg-white"} border ${a?"border-gray-700":"border-gray-200"}`,children:p.jsxs("div",{className:"flex items-center",children:[p.jsx(v,{className:"text-2xl text-yellow-500 mr-3"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold "+(a?"text-white":"text-gray-900"),children:l.filter(e=>"pending"===e.status).length}),p.jsx("p",{className:"text-sm "+(a?"text-gray-400":"text-gray-600"),children:"Pending"})]})]})}),p.jsx("div",{className:`p-4 rounded-lg ${a?"bg-gray-800":"bg-white"} border ${a?"border-gray-700":"border-gray-200"}`,children:p.jsxs("div",{className:"flex items-center",children:[p.jsx(N,{className:"text-2xl text-green-500 mr-3"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold "+(a?"text-white":"text-gray-900"),children:l.filter(e=>"approved"===e.status).length}),p.jsx("p",{className:"text-sm "+(a?"text-gray-400":"text-gray-600"),children:"Approved"})]})]})}),p.jsx("div",{className:`p-4 rounded-lg ${a?"bg-gray-800":"bg-white"} border ${a?"border-gray-700":"border-gray-200"}`,children:p.jsxs("div",{className:"flex items-center",children:[p.jsx(w,{className:"text-2xl text-red-500 mr-3"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold "+(a?"text-white":"text-gray-900"),children:l.filter(e=>"rejected"===e.status).length}),p.jsx("p",{className:"text-sm "+(a?"text-gray-400":"text-gray-600"),children:"Rejected"})]})]})}),p.jsx("div",{className:`p-4 rounded-lg ${a?"bg-gray-800":"bg-white"} border ${a?"border-gray-700":"border-gray-200"}`,children:p.jsxs("div",{className:"flex items-center",children:[p.jsx(j,{className:"text-2xl text-blue-500 mr-3"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold "+(a?"text-white":"text-gray-900"),children:K(R?R.total_paid:l.filter(e=>"approved"===e.status).reduce((e,t)=>e+(parseFloat(t.amount)||0),0))}),p.jsx("p",{className:"text-sm "+(a?"text-gray-400":"text-gray-600"),children:"Total Approved Amount"})]})]})})]}),p.jsx("div",{className:"rounded-xl shadow-sm border "+(a?"bg-gray-800 border-gray-700":"bg-white border-gray-100"),children:0===l.length?p.jsxs("div",{className:"p-8 text-center",children:[p.jsx(_,{className:"text-6xl mx-auto mb-4 "+(a?"text-gray-600":"text-gray-400")}),p.jsx("h3",{className:"text-lg font-semibold mb-2 "+(a?"text-white":"text-gray-900"),children:"No Payment Proofs Found"}),p.jsx("p",{className:""+(a?"text-gray-400":"text-gray-600"),children:"No payment proofs match your current filters."})]}):p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"min-w-full",children:[p.jsx("thead",{className:""+(a?"bg-gray-700":"bg-gray-50"),children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider "+(a?"text-gray-300":"text-gray-500"),children:"Parent / Child"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider "+(a?"text-gray-300":"text-gray-500"),children:"Amount"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider "+(a?"text-gray-300":"text-gray-500"),children:"Payment Date"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider "+(a?"text-gray-300":"text-gray-500"),children:"Reference"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider "+(a?"text-gray-300":"text-gray-500"),children:"Status"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider "+(a?"text-gray-300":"text-gray-500"),children:"Actions"})]})}),p.jsx("tbody",{className:"divide-y "+(a?"divide-gray-700":"divide-gray-200"),children:l.map(e=>p.jsxs("tr",{className:"hover:"+(a?"bg-gray-700":"bg-gray-50"),children:[p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.jsxs("div",{children:[p.jsx("div",{className:"text-sm font-medium "+(a?"text-white":"text-gray-900"),children:e.parent_name}),p.jsx("div",{className:"text-sm "+(a?"text-gray-400":"text-gray-500"),children:e.child_name})]})}),p.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[p.jsx("div",{className:"text-sm font-medium "+(a?"text-white":"text-gray-900"),children:K(parseFloat(e.amount)||0)}),p.jsx("div",{className:"text-sm "+(a?"text-gray-400":"text-gray-500"),children:e.payment_method})]}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.jsx("div",{className:"text-sm "+(a?"text-gray-300":"text-gray-900"),children:H(e.payment_date)})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.jsx("div",{className:"text-sm font-mono "+(a?"text-gray-300":"text-gray-900"),children:e.reference_number})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${X(e.status)}`,children:[Y(e.status),p.jsx("span",{className:"ml-1 capitalize",children:e.status})]})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:p.jsxs("div",{className:"flex space-x-2",children:[p.jsx("button",{onClick:()=>{E(e),L(!0)},className:"text-blue-600 hover:text-blue-900",title:"View Details",children:p.jsx(k,{className:"w-4 h-4"})}),"pending"===e.status&&p.jsxs(p.Fragment,{children:[p.jsx("button",{onClick:()=>U(e.id),disabled:I===`approve-${e.id}`,className:"text-green-600 hover:text-green-900 disabled:opacity-50",title:"Approve",children:I===`approve-${e.id}`?p.jsx(v,{className:"w-4 h-4 animate-spin"}):p.jsx(P,{className:"w-4 h-4"})}),p.jsx("button",{onClick:()=>V(e.id,"Rejected by admin"),disabled:I===`reject-${e.id}`,className:"text-red-600 hover:text-red-900 disabled:opacity-50",title:"Reject",children:I===`reject-${e.id}`?p.jsx(v,{className:"w-4 h-4 animate-spin"}):p.jsx(S,{className:"w-4 h-4"})})]})]})})]},e.id))})]})})})]})}),Z&&O&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:p.jsx("div",{className:"w-full max-w-2xl rounded-xl shadow-lg "+(a?"bg-gray-800":"bg-white"),children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("h3",{className:"text-xl font-bold "+(a?"text-white":"text-gray-900"),children:"Payment Proof Details"}),p.jsx("button",{onClick:()=>L(!1),className:"rounded-lg p-2 hover:bg-opacity-10 "+(a?"hover:bg-gray-300":"hover:bg-gray-600"),children:p.jsx(S,{className:a?"text-gray-400":"text-gray-600"})})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Parent Name"}),p.jsx("p",{className:"mt-1 "+(a?"text-white":"text-gray-900"),children:O.parent_name})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Child Name"}),p.jsx("p",{className:"mt-1 "+(a?"text-white":"text-gray-900"),children:O.child_name})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Amount"}),p.jsx("p",{className:"mt-1 text-lg font-semibold "+(a?"text-white":"text-gray-900"),children:K(parseFloat(O.amount)||0)})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Payment Method"}),p.jsx("p",{className:"mt-1 "+(a?"text-white":"text-gray-900"),children:O.payment_method.replace("_"," ")})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Payment Date"}),p.jsx("p",{className:"mt-1 "+(a?"text-white":"text-gray-900"),children:H(O.payment_date)})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Reference Number"}),p.jsx("p",{className:"mt-1 font-mono "+(a?"text-white":"text-gray-900"),children:O.reference_number})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Status"}),p.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border mt-1 ${X(O.status)}`,children:[Y(O.status),p.jsx("span",{className:"ml-1 capitalize",children:O.status})]})]}),O.rejection_reason&&p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Rejection Reason"}),p.jsx("p",{className:"mt-1 text-red-600",children:O.rejection_reason})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium "+(a?"text-gray-300":"text-gray-700"),children:"Proof File"}),p.jsx("div",{className:"mt-2",children:p.jsxs("button",{className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[p.jsx(D,{className:"mr-2 w-4 h-4"}),"Download Proof"]})})]})]}),"pending"===O.status&&p.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200",children:[p.jsxs("button",{onClick:()=>V(O.id,"Rejected by admin"),disabled:I===`reject-${O.id}`,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center",children:[I===`reject-${O.id}`?p.jsx(v,{className:"w-4 h-4 animate-spin mr-2"}):p.jsx(S,{className:"w-4 h-4 mr-2"}),"Reject"]}),p.jsxs("button",{onClick:()=>U(O.id),disabled:I===`approve-${O.id}`,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center",children:[I===`approve-${O.id}`?p.jsx(v,{className:"w-4 h-4 animate-spin mr-2"}):p.jsx(P,{className:"w-4 h-4 mr-2"}),"Approve"]})]}),"rejected"===O.status&&p.jsx("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200",children:p.jsxs("button",{onClick:()=>{return e=O.id,c(void 0,null,function*(){var t,a;if(confirm("Are you sure you want to delete this rejected payment proof?"))try{B(e),yield g.payments.deleteRejectedProof(e),y.success("Rejected payment proof deleted successfully"),r(t=>t.filter(t=>t.id!==e));try{const e=yield g.payments.getAdminSummary();$(e.data.summary)}catch(s){}O&&O.id===e&&L(!1)}catch(s){y.error((null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.message)||"Failed to delete rejected proof")}finally{B(null)}});var e},disabled:z===O.id,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center",children:[z===O.id?p.jsx(v,{className:"w-4 h-4 animate-spin mr-2"}):p.jsx(A,{className:"w-4 h-4 mr-2"}),"Delete"]})})]})})})]})};export{R as default};
