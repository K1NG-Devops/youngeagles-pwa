var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,d=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&n(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&n(e,s,t[s]);return e},i=(e,a)=>t(e,s(a)),c=(e,t,s)=>new Promise((a,r)=>{var l=e=>{try{d(s.next(e))}catch(t){r(t)}},n=e=>{try{d(s.throw(e))}catch(t){r(t)}},d=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,n);d((s=s.apply(e,t)).next())});import{r as o}from"./vendor-react-BHu_3aIX.js";import{u as x,l as g,A as h,j as m,r as b,C as y,_ as u,aj as j,U as v,ax as p,aa as N,Z as f,D as w,a7 as S,n as k}from"./index-BetBoxhn.js";import{u as C}from"./vendor-router-BfAStt8k.js";import"./vendor-utils-C_UPlz3V.js";const O=()=>{const{user:e}=x(),{isDark:t}=g(),s=C(),[a,r]=o.useState((new Date).toISOString().split("T")[0]),[l,n]=o.useState([]),[O,D]=o.useState({}),[P,A]=o.useState(!0),[B,E]=o.useState(!1),[F,I]=o.useState(""),[T,$]=o.useState(null),[M,_]=o.useState([]),[L,q]=o.useState(null),[z,R]=o.useState(null);o.useEffect(()=>{c(void 0,null,function*(){var t,s;if(!e||"teacher"!==e.role)return R("Access denied: Teacher account required"),void A(!1);try{A(!0),R(null);const t=(yield h.classes.getByTeacher(e.id)).data.classes||[];if(0===t.length){try{const e=yield h.attendance.getByClass(a);if(e.data.success&&e.data.students&&e.data.students.length>0){const t={id:e.data.classId||1,name:e.data.className||"My Class",student_count:e.data.totalStudents||e.data.students.length};_([t]),$(t),I(t.name),q(t.id);const s=e.data.students.map(e=>({id:e.id,name:e.name||`Student ${e.id}`,gender:e.gender||"unknown",avatar:"female"===e.gender?"ðŸ‘§":"male"===e.gender?"ðŸ‘¦":"ðŸ‘¤"}));return n(s),yield U(t.id,a,s),void A(!1)}}catch(r){}return R("No classes or students assigned to this teacher"),void A(!1)}_(t);const s=L&&t.find(e=>e.id===L)||t[0];$(s),I(s.name),q(s.id);const c=(yield h.classes.getChildren(s.id)).data.children||[];if(0===c.length)try{const e=yield h.attendance.getByClass(a);if(e.data.success&&e.data.students){const t=e.data.students.map(e=>({id:e.id,name:e.name||`Student ${e.id}`,gender:e.gender||"unknown",avatar:"female"===e.gender?"ðŸ‘§":"male"===e.gender?"ðŸ‘¦":"ðŸ‘¤"}));return n(t),void(yield U(s.id,a,t))}}catch(l){}const o=c.map(e=>i(d({},e),{avatar:"female"===e.gender?"ðŸ‘§":"male"===e.gender?"ðŸ‘¦":"ðŸ‘¤"}));n(o),yield U(s.id,a,o)}catch(l){R((null==(s=null==(t=l.response)?void 0:t.data)?void 0:s.message)||"Failed to load class data"),k.error("Failed to load class data")}finally{A(!1)}})},[e,L,a]),o.useEffect(()=>{T&&l.length>0&&U(T.id,a,l)},[a,l,T]);const U=(e,t,s)=>c(void 0,null,function*(){try{const e=(yield h.attendance.getByClass(t)).data;if(e.success&&e.students){const t={};e.students.forEach(e=>{t[e.id]=e.attendance_status||"present"}),D(t)}else{const e={};s.forEach(t=>{e[t.id]="present"}),D(e)}}catch(e){const t={};s.forEach(e=>{t[e.id]="present"}),D(t)}}),Z=(e,t)=>{D(s=>i(d({},s),{[e]:t}))},G={total:l.length,present:Object.values(O).filter(e=>"present"===e).length,absent:Object.values(O).filter(e=>"absent"===e).length,late:Object.values(O).filter(e=>"late"===e).length};return P?m.jsx("div",{className:"flex items-center justify-center min-h-screen "+(t?"bg-gray-900":"bg-gray-50"),children:m.jsxs("div",{className:"text-center",children:[m.jsx(b,{className:"animate-spin h-12 w-12 text-blue-500 mx-auto mb-4"}),m.jsx("p",{className:""+(t?"text-gray-300":"text-gray-600"),children:"Loading class register..."})]})}):z?m.jsx("div",{className:"flex items-center justify-center min-h-screen "+(t?"bg-gray-900":"bg-gray-50"),children:m.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[m.jsx(y,{className:"h-16 w-16 mx-auto mb-4 "+(t?"text-red-400":"text-red-500")}),m.jsx("h2",{className:"text-xl font-semibold mb-2 "+(t?"text-white":"text-gray-900"),children:"Access Error"}),m.jsx("p",{className:"mb-4 "+(t?"text-gray-300":"text-gray-600"),children:z}),m.jsxs("button",{onClick:()=>s("/dashboard"),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[m.jsx(u,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})]})}):0===l.length?m.jsx("div",{className:"flex items-center justify-center min-h-screen "+(t?"bg-gray-900":"bg-gray-50"),children:m.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[m.jsx(j,{className:"h-16 w-16 mx-auto mb-4 "+(t?"text-gray-400":"text-gray-500")}),m.jsx("h2",{className:"text-xl font-semibold mb-2 "+(t?"text-white":"text-gray-900"),children:"No Students Found"}),m.jsx("p",{className:"mb-4 "+(t?"text-gray-300":"text-gray-600"),children:"This class doesn't have any students enrolled yet."}),m.jsxs("button",{onClick:()=>s("/dashboard"),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[m.jsx(u,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})]})}):m.jsx("div",{className:`min-h-screen mt-20 rounded-lg ${t?"bg-gray-900":"bg-gray-50"} pb-4`,children:m.jsxs("div",{className:"p-4 space-y-6 pb-4",children:[m.jsx("div",{className:"p-4 border-b rounded-xl sticky top-0 z-10 "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("button",{onClick:()=>s("/dashboard"),className:"inline-flex items-center px-3 py-2 rounded-lg transition-colors "+(t?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[m.jsx(u,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),m.jsxs("div",{className:"text-center",children:[m.jsx("h1",{className:"text-xl font-bold "+(t?"text-white":"text-gray-900"),children:"Class Register"}),M.length>1?m.jsxs("div",{className:"flex items-center justify-center mt-2",children:[m.jsx("select",{value:L||"",onChange:e=>(e=>{const t=M.find(t=>t.id===parseInt(e));t&&(q(t.id),$(t),I(t.name))})(e.target.value),className:"px-3 py-1 rounded-lg border text-sm "+(t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"),children:M.map(e=>m.jsx("option",{value:e.id,children:e.name},e.id))}),m.jsx(v,{className:"w-3 h-3 ml-2 "+(t?"text-gray-400":"text-gray-600")})]}):m.jsx("p",{className:"text-sm "+(t?"text-gray-400":"text-gray-600"),children:F})]}),m.jsx("button",{onClick:()=>c(void 0,null,function*(){var e,t,s,r;if(T)try{E(!0);const e=l.map(e=>({childId:e.id,status:O[e.id]||"present",notes:null})),t=(yield h.attendance.bulkMark(a,e),Object.values(O).filter(e=>"present"===e).length),s=Object.values(O).filter(e=>"absent"===e).length,r=Object.values(O).filter(e=>"late"===e).length;k.success(`Attendance saved! ${t} present, ${s} absent, ${r} late`),yield U(T.id,a,l)}catch(n){const a=(null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.error)||(null==(r=null==(s=n.response)?void 0:s.data)?void 0:r.message)||"Failed to save attendance";k.error(a)}finally{E(!1)}else k.error("No class selected")}),disabled:B,className:"inline-flex items-center px-4 py-2 rounded-lg font-medium transition-colors "+(B?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:B?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):m.jsxs(m.Fragment,{children:[m.jsx(p,{className:"w-4 h-4 mr-2"}),"Save"]})})]})}),m.jsx("div",{className:"p-4 rounded-xl border "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx(N,{className:"w-5 h-5 mr-3 "+(t?"text-blue-400":"text-blue-600")}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-medium "+(t?"text-white":"text-gray-900"),children:"Attendance Date"}),m.jsx("p",{className:"text-sm "+(t?"text-gray-400":"text-gray-600"),children:"Select the date to mark attendance"})]})]}),m.jsx("input",{type:"date",value:a,onChange:e=>r(e.target.value),className:"px-3 py-2 rounded-lg border "+(t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900")})]})}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[m.jsx("div",{className:"p-4 rounded-xl border "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"p-2 rounded-lg "+(t?"bg-blue-900/20":"bg-blue-100"),children:m.jsx(j,{className:"w-5 h-5 "+(t?"text-blue-400":"text-blue-600")})}),m.jsxs("div",{className:"ml-3",children:[m.jsx("p",{className:"text-2xl font-bold "+(t?"text-white":"text-gray-900"),children:G.total}),m.jsx("p",{className:"text-xs "+(t?"text-gray-400":"text-gray-600"),children:"Total"})]})]})}),m.jsx("div",{className:"p-4 rounded-xl border "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"p-2 rounded-lg "+(t?"bg-green-900/20":"bg-green-100"),children:m.jsx(f,{className:"w-5 h-5 "+(t?"text-green-400":"text-green-600")})}),m.jsxs("div",{className:"ml-3",children:[m.jsx("p",{className:"text-2xl font-bold "+(t?"text-white":"text-gray-900"),children:G.present}),m.jsx("p",{className:"text-xs "+(t?"text-gray-400":"text-gray-600"),children:"Present"})]})]})}),m.jsx("div",{className:"p-4 rounded-xl border "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"p-2 rounded-lg "+(t?"bg-red-900/20":"bg-red-100"),children:m.jsx(w,{className:"w-5 h-5 "+(t?"text-red-400":"text-red-600")})}),m.jsxs("div",{className:"ml-3",children:[m.jsx("p",{className:"text-2xl font-bold "+(t?"text-white":"text-gray-900"),children:G.absent}),m.jsx("p",{className:"text-xs "+(t?"text-gray-400":"text-gray-600"),children:"Absent"})]})]})}),m.jsx("div",{className:"p-4 rounded-xl border "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"p-2 rounded-lg "+(t?"bg-yellow-900/20":"bg-yellow-100"),children:m.jsx(S,{className:"w-5 h-5 "+(t?"text-yellow-400":"text-yellow-600")})}),m.jsxs("div",{className:"ml-3",children:[m.jsx("p",{className:"text-2xl font-bold "+(t?"text-white":"text-gray-900"),children:G.late}),m.jsx("p",{className:"text-xs "+(t?"text-gray-400":"text-gray-600"),children:"Late"})]})]})})]}),m.jsxs("div",{className:"rounded-xl border "+(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[m.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[m.jsx("h3",{className:"text-lg font-semibold "+(t?"text-white":"text-gray-900"),children:"Mark Attendance"}),m.jsx("p",{className:"text-sm "+(t?"text-gray-400":"text-gray-600"),children:"Tap on students to mark their attendance status"})]}),m.jsx("div",{className:"p-4",children:m.jsx("div",{className:"grid grid-cols-1 gap-3",children:l.map(e=>m.jsx("div",{className:"p-4 rounded-lg border transition-all "+(t?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"text-2xl mr-3",children:e.avatar}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium "+(t?"text-white":"text-gray-900"),children:e.name}),m.jsxs("p",{className:"text-sm "+(t?"text-gray-400":"text-gray-600"),children:["Student ID: ",e.id.toString().padStart(3,"0")]})]})]}),m.jsxs("div",{className:"flex space-x-2",children:[m.jsx("button",{onClick:()=>Z(e.id,"present"),className:"p-2 rounded-lg transition-colors "+("present"===O[e.id]?"bg-green-600 text-white":t?"bg-gray-600 text-gray-300 hover:bg-green-600 hover:text-white":"bg-gray-200 text-gray-600 hover:bg-green-600 hover:text-white"),children:m.jsx(f,{className:"w-4 h-4"})}),m.jsx("button",{onClick:()=>Z(e.id,"late"),className:"p-2 rounded-lg transition-colors "+("late"===O[e.id]?"bg-yellow-600 text-white":t?"bg-gray-600 text-gray-300 hover:bg-yellow-600 hover:text-white":"bg-gray-200 text-gray-600 hover:bg-yellow-600 hover:text-white"),children:m.jsx(S,{className:"w-4 h-4"})}),m.jsx("button",{onClick:()=>Z(e.id,"absent"),className:"p-2 rounded-lg transition-colors "+("absent"===O[e.id]?"bg-red-600 text-white":t?"bg-gray-600 text-gray-300 hover:bg-red-600 hover:text-white":"bg-gray-200 text-gray-600 hover:bg-red-600 hover:text-white"),children:m.jsx(w,{className:"w-4 h-4"})})]})]})},e.id))})})]})]})})};export{O as default};
