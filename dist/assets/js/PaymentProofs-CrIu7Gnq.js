var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(s,r,t)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,n=(e,s)=>{for(var r in s||(s={}))a.call(s,r)&&d(e,r,s[r]);if(t)for(var r of t(s))l.call(s,r)&&d(e,r,s[r]);return e},o=(e,t)=>s(e,r(t)),m=(e,s,r)=>new Promise((t,a)=>{var l=e=>{try{n(r.next(e))}catch(s){a(s)}},d=e=>{try{n(r.throw(e))}catch(s){a(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,d);n((r=r.apply(e,s)).next())});import{r as i}from"./vendor-react-BHu_3aIX.js";import{u as x,l as c,j as b,_ as g,bt as p,ac as u,r as h,aJ as y,aa as f,av as j,A as v,n as N,D as w,Z as _}from"./index-BetBoxhn.js";import{u as P}from"./vendor-router-BfAStt8k.js";import"./vendor-utils-C_UPlz3V.js";const S=()=>{const e=P(),{user:s}=x(),{isDark:r}=c(),[t,a]=i.useState([]),[l,d]=i.useState([]),[S,k]=i.useState(null),[C,O]=i.useState(!1),[D,F]=i.useState(!1),[R,A]=i.useState(null),[B,T]=i.useState({child_id:"",amount:"",payment_date:(new Date).toISOString().split("T")[0],reference_number:"",payment_method:"bank_transfer",proof_file:null});i.useEffect(()=>{s&&m(void 0,null,function*(){O(!0);try{const r=yield v.children.getByParent(s.id);a(r.data.children||[]);try{const e=yield v.payments.getProofs();d(e.data.proofs||[])}catch(e){d([])}try{const e=yield v.payments.getSummary();k(e.data.summary)}catch(e){}}catch(e){N.error("Failed to load data")}finally{O(!1)}})},[s]);const q=e=>{const{name:s,value:r,files:t}=e.target;T("proof_file"===s?e=>o(n({},e),{[s]:t[0]}):e=>o(n({},e),{[s]:r}))},E=e=>{switch(e){case"approved":return r?"text-green-400 bg-green-900/20 border-green-800":"text-green-600 bg-green-50 border-green-200";case"rejected":return r?"text-red-400 bg-red-900/20 border-red-800":"text-red-600 bg-red-50 border-red-200";default:return r?"text-yellow-400 bg-yellow-900/20 border-yellow-800":"text-yellow-600 bg-yellow-50 border-yellow-200"}},I=e=>{switch(e){case"approved":return b.jsx(_,{className:"w-4 h-4"});case"rejected":return b.jsx(w,{className:"w-4 h-4"});default:return b.jsx(h,{className:"w-4 h-4 animate-spin"})}};return C?b.jsx("div",{className:"flex items-center justify-center min-h-screen "+(r?"bg-gray-900":"bg-gray-50"),children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),b.jsx("p",{className:""+(r?"text-gray-300":"text-gray-600"),children:"Loading payment proofs..."})]})}):b.jsxs("div",{className:`min-h-screen ${r?"bg-gray-900":"bg-gray-50"} pb-12`,children:[b.jsx("div",{className:"sticky top-0 z-10 w-full rounded-xl border-b backdrop-blur-md "+(r?"bg-gray-800/95 border-gray-700":"bg-white/95 border-gray-200"),children:b.jsxs("div",{className:"flex items-center justify-between w-full max-w-7xl mx-2 sm:mx-4 px-2 sm:px-4 py-3 sm:py-4",children:[b.jsxs("button",{onClick:()=>e("/dashboard"),className:"inline-flex items-center px-3 py-2 rounded-lg font-medium transition-all duration-200 min-h-[44px] "+(r?"text-gray-300 hover:bg-gray-700 hover:text-white hover:shadow-lg":"text-gray-600 hover:bg-gray-100 hover:text-gray-900 hover:shadow-md"),children:[b.jsx(g,{className:"w-4 h-4 mr-2"}),b.jsx("span",{className:"hidden sm:inline",children:"Back to Dashboard"}),b.jsx("span",{className:"sm:hidden",children:"Back"})]}),b.jsxs("div",{className:"text-center flex-1 mx-2",children:[b.jsx("h1",{className:"text-lg sm:text-xl font-bold "+(r?"text-white":"text-gray-900"),children:"ðŸ’° Payment Proofs"}),b.jsx("p",{className:"text-xs sm:text-sm "+(r?"text-gray-400":"text-gray-600"),children:"Submit proof of payment for school fees"})]}),b.jsx("div",{className:"w-16 sm:w-24"})," "]})}),b.jsxs("div",{className:"w-full max-w-7xl mx-2 sm:mx-4 px-2 sm:px-4 space-y-4 sm:space-y-6 mt-4 sm:mt-6",children:[S&&b.jsx("div",{className:"rounded-xl sm:rounded-2xl shadow-lg border backdrop-blur-sm "+(r?"bg-gray-800/90 border-gray-700":"bg-white/90 border-gray-100"),children:b.jsxs("div",{className:"p-4 sm:p-6",children:[b.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-green-600 text-white p-4 rounded-xl mb-6",children:[b.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[b.jsx(p,{className:"mr-3"}),"Payment Summary"]}),b.jsx("p",{className:"text-emerald-100 text-sm mt-1",children:"Overview of your approved payments"})]}),b.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[b.jsxs("div",{className:"p-3 sm:p-4 rounded-xl border-2 "+(r?"bg-emerald-900/20 border-emerald-800":"bg-emerald-50 border-emerald-200"),children:[b.jsxs("div",{className:"text-lg sm:text-2xl font-bold "+(r?"text-emerald-400":"text-emerald-600"),children:["R",S.total_paid.toFixed(2)]}),b.jsx("div",{className:"text-xs sm:text-sm "+(r?"text-gray-400":"text-gray-600"),children:"Total Paid (Approved)"})]}),b.jsxs("div",{className:"p-3 sm:p-4 rounded-xl border-2 "+(r?"bg-green-900/20 border-green-800":"bg-green-50 border-green-200"),children:[b.jsx("div",{className:"text-lg sm:text-2xl font-bold "+(r?"text-green-400":"text-green-600"),children:S.total_approved_payments}),b.jsx("div",{className:"text-xs sm:text-sm "+(r?"text-gray-400":"text-gray-600"),children:"Approved Payments"})]}),b.jsxs("div",{className:"p-3 sm:p-4 rounded-xl border-2 "+(r?"bg-yellow-900/20 border-yellow-800":"bg-yellow-50 border-yellow-200"),children:[b.jsx("div",{className:"text-lg sm:text-2xl font-bold "+(r?"text-yellow-400":"text-yellow-600"),children:S.pending_payments}),b.jsx("div",{className:"text-xs sm:text-sm "+(r?"text-gray-400":"text-gray-600"),children:"Pending Review"})]}),b.jsxs("div",{className:"p-3 sm:p-4 rounded-xl border-2 "+(r?"bg-red-900/20 border-red-800":"bg-red-50 border-red-200"),children:[b.jsx("div",{className:"text-lg sm:text-2xl font-bold "+(r?"text-red-400":"text-red-600"),children:S.rejected_payments}),b.jsx("div",{className:"text-xs sm:text-sm "+(r?"text-gray-400":"text-gray-600"),children:"Rejected"})]})]})]})}),b.jsx("div",{className:"rounded-xl sm:rounded-2xl shadow-lg border backdrop-blur-sm "+(r?"bg-gray-800/90 border-gray-700":"bg-white/90 border-gray-100"),children:b.jsxs("div",{className:"p-4 sm:p-6",children:[b.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-3 sm:p-4 rounded-xl mb-4 sm:mb-6",children:[b.jsxs("h2",{className:"text-lg sm:text-xl font-semibold flex items-center",children:[b.jsx(p,{className:"mr-2 sm:mr-3"}),"Submit Payment Proof"]}),b.jsx("p",{className:"text-green-100 text-xs sm:text-sm mt-1",children:"Upload your payment receipt or bank statement"})]}),b.jsxs("form",{onSubmit:e=>m(void 0,null,function*(){var s,r;if(e.preventDefault(),B.proof_file){F(!0);try{const e=new FormData;Object.keys(B).forEach(s=>{null!==B[s]&&""!==B[s]&&e.append(s,B[s])}),yield v.payments.submitProof(e),N.success("Payment proof submitted successfully!"),T({child_id:"",amount:"",payment_date:(new Date).toISOString().split("T")[0],reference_number:"",payment_method:"bank_transfer",proof_file:null});const s=document.getElementById("proof_file");s&&(s.value="");try{const e=yield v.payments.getProofs();d(e.data.proofs||[]);const s=yield v.payments.getSummary();k(s.data.summary)}catch(t){}}catch(t){N.error((null==(r=null==(s=t.response)?void 0:s.data)?void 0:r.message)||"Failed to submit payment proof")}finally{F(!1)}}else N.error("Please select a file to upload")}),className:"space-y-4 sm:space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[b.jsxs("div",{children:[b.jsxs("label",{className:"block text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:["Child ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsxs("select",{name:"child_id",value:B.child_id,onChange:q,required:!0,className:"w-full px-3 sm:px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:ring-2 focus:ring-blue-500/20 min-h-[44px] "+(r?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 shadow-sm"),children:[b.jsx("option",{value:"",children:"Select Child"}),t.map(e=>b.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),b.jsxs("div",{children:[b.jsxs("label",{className:"block text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:["Amount (R) ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{type:"number",name:"amount",value:B.amount,onChange:q,required:!0,min:"0",step:"0.01",placeholder:"0.00",className:"w-full px-3 sm:px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:ring-2 focus:ring-blue-500/20 min-h-[44px] "+(r?"bg-gray-700 border-gray-600 text-white focus:border-blue-500 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 placeholder-gray-500 shadow-sm")})]}),b.jsxs("div",{children:[b.jsxs("label",{className:"block text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:["Payment Date ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{type:"date",name:"payment_date",value:B.payment_date,onChange:q,required:!0,className:"w-full px-3 sm:px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:ring-2 focus:ring-blue-500/20 min-h-[44px] "+(r?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 shadow-sm")})]}),b.jsxs("div",{children:[b.jsxs("label",{className:"block text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:["Payment Method ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsxs("select",{name:"payment_method",value:B.payment_method,onChange:q,required:!0,className:"w-full px-3 sm:px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:ring-2 focus:ring-blue-500/20 min-h-[44px] "+(r?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 shadow-sm"),children:[b.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),b.jsx("option",{value:"eft",children:"EFT"}),b.jsx("option",{value:"cash",children:"Cash"}),b.jsx("option",{value:"card",children:"Card Payment"})]})]}),b.jsxs("div",{className:"lg:col-span-2",children:[b.jsx("label",{className:"block text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:"Reference Number"}),b.jsx("input",{type:"text",name:"reference_number",value:B.reference_number,onChange:q,placeholder:"Optional reference number",className:"w-full px-3 sm:px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:ring-2 focus:ring-blue-500/20 min-h-[44px] "+(r?"bg-gray-700 border-gray-600 text-white focus:border-blue-500 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 placeholder-gray-500 shadow-sm")})]}),b.jsxs("div",{className:"lg:col-span-2",children:[b.jsxs("label",{className:"block text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:["Payment Proof File ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsxs("div",{className:"border-3 border-dashed rounded-xl sm:rounded-2xl p-6 sm:p-8 text-center transition-all duration-300 hover:border-blue-500 "+(r?"border-gray-600 bg-gray-700/30":"border-gray-300 bg-gray-50/50"),children:[b.jsx(u,{className:"mx-auto text-4xl sm:text-5xl mb-3 sm:mb-4 "+(r?"text-gray-400":"text-gray-500")}),b.jsx("p",{className:"mb-3 sm:mb-4 text-sm sm:text-base font-medium "+(r?"text-gray-300":"text-gray-600"),children:"Upload proof of payment"}),b.jsx("p",{className:"text-xs sm:text-sm mb-4 sm:mb-6 "+(r?"text-gray-400":"text-gray-500"),children:"Supported formats: PNG, JPG, PDF (Max 10MB)"}),b.jsx("input",{type:"file",id:"proof_file",name:"proof_file",onChange:q,accept:".png,.jpg,.jpeg,.pdf",required:!0,className:"hidden"}),b.jsxs("label",{htmlFor:"proof_file",className:"inline-flex items-center px-4 sm:px-6 py-3 rounded-xl cursor-pointer font-medium transition-all duration-200 hover:shadow-lg transform hover:scale-105 min-h-[44px] "+(r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white shadow-md"),children:[b.jsx(u,{className:"w-4 h-4 mr-2"}),"Choose File"]}),B.proof_file&&b.jsx("div",{className:"mt-3 sm:mt-4 p-3 rounded-xl "+(r?"bg-green-900/20 border border-green-800":"bg-green-50 border border-green-200"),children:b.jsxs("p",{className:"text-xs sm:text-sm font-medium "+(r?"text-green-400":"text-green-600"),children:["âœ“ Selected: ",B.proof_file.name]})})]})]})]}),b.jsx("div",{className:"flex justify-center pt-4 sm:pt-6 border-t border-gray-200 dark:border-gray-700",children:b.jsx("button",{type:"submit",disabled:D,className:`inline-flex items-center px-6 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 min-h-[44px] ${D?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 shadow-lg hover:shadow-xl"} text-white`,children:D?b.jsxs(b.Fragment,{children:[b.jsx(h,{className:"w-4 h-4 mr-2 animate-spin"}),b.jsx("span",{className:"text-sm sm:text-base",children:"Submitting..."})]}):b.jsxs(b.Fragment,{children:[b.jsx(u,{className:"w-4 h-4 mr-2"}),b.jsx("span",{className:"text-sm sm:text-base",children:"Submit Payment Proof"})]})})})]})]})}),b.jsx("div",{className:"rounded-xl sm:rounded-2xl shadow-lg border backdrop-blur-sm "+(r?"bg-gray-800/90 border-gray-700":"bg-white/90 border-gray-100"),children:b.jsxs("div",{className:"p-4 sm:p-6",children:[b.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 sm:p-4 rounded-xl mb-4 sm:mb-6",children:[b.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[b.jsx(y,{className:"mr-2 sm:mr-3"}),"Recent Submissions"]}),b.jsx("p",{className:"text-blue-100 text-xs sm:text-sm mt-1",children:"Track the status of your payment proofs"})]}),0===l.length?b.jsxs("div",{className:"text-center py-12 sm:py-16 "+(r?"text-gray-400":"text-gray-500"),children:[b.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full mx-auto mb-4 sm:mb-6 flex items-center justify-center "+(r?"bg-gray-700":"bg-gray-100"),children:b.jsx(y,{className:"text-3xl sm:text-4xl opacity-50"})}),b.jsx("p",{className:"text-base sm:text-lg font-medium mb-2",children:"No payment proofs submitted yet"}),b.jsx("p",{className:"text-xs sm:text-sm",children:"Submit your first payment proof using the form above"})]}):b.jsx("div",{className:"space-y-3 sm:space-y-4",children:l.map((e,s)=>{return b.jsxs("div",{className:"border-2 rounded-xl p-3 sm:p-5 transition-all duration-200 hover:shadow-md "+(r?"border-gray-600 bg-gray-700/30":"border-gray-200 bg-gray-50/50"),children:[b.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[b.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4 flex-1 min-w-0",children:[b.jsx("div",{className:`p-2 sm:p-3 rounded-xl border-2 flex-shrink-0 ${E(e.status)}`,children:I(e.status)}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsxs("p",{className:"font-semibold text-sm sm:text-lg truncate "+(r?"text-white":"text-gray-900"),children:["R",e.amount," - ",e.child_name]}),b.jsxs("p",{className:"text-xs sm:text-sm flex items-center "+(r?"text-gray-400":"text-gray-600"),children:[b.jsx(f,{className:"w-3 h-3 mr-1 flex-shrink-0"}),(t=e.payment_date,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})]}),b.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[b.jsxs("span",{className:`inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-bold capitalize border-2 ${E(e.status)}`,children:[b.jsx("span",{className:"hidden sm:inline",children:e.status||"pending"}),b.jsx("span",{className:"sm:hidden",children:(e.status||"pending").charAt(0).toUpperCase()})]}),"rejected"===e.status&&b.jsx("button",{onClick:()=>{return s=e.id,m(void 0,null,function*(){var e,r;if(confirm("Are you sure you want to delete this rejected payment proof?"))try{A(s),yield v.payments.deleteRejectedProof(s),N.success("Rejected payment proof deleted successfully");const e=yield v.payments.getProofs();d(e.data.proofs||[]);const r=yield v.payments.getSummary();k(r.data.summary)}catch(t){N.error((null==(r=null==(e=t.response)?void 0:e.data)?void 0:r.message)||"Failed to delete rejected proof")}finally{A(null)}});var s},disabled:R===e.id,className:"p-2 rounded-lg transition-all hover:scale-105 min-h-[36px] min-w-[36px] "+(R===e.id?"bg-gray-400 cursor-not-allowed":r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-500 hover:bg-red-600 text-white"),title:"Delete rejected proof",children:R===e.id?b.jsx(h,{className:"w-3 h-3 animate-spin"}):b.jsx(j,{className:"w-3 h-3"})})]})]}),e.reference_number&&b.jsxs("p",{className:"text-xs sm:text-sm mb-3 "+(r?"text-gray-400":"text-gray-600"),children:["Reference: ",e.reference_number]}),e.admin_notes&&b.jsxs("div",{className:"p-3 sm:p-4 rounded-xl border-l-4 "+(r?"bg-gray-700 border-blue-400":"bg-blue-50 border-blue-400"),children:[b.jsx("p",{className:"text-xs sm:text-sm font-semibold mb-2 "+(r?"text-gray-300":"text-gray-700"),children:"ðŸ’¬ Admin Notes:"}),b.jsx("p",{className:"text-xs sm:text-sm "+(r?"text-gray-400":"text-gray-600"),children:e.admin_notes})]})]},e.id||s);var t})})]})})]})]})};export{S as default};
